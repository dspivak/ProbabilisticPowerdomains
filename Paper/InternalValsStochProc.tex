\documentclass[11pt, oneside, article]{memoir} 
\settrims{0pt}{0pt} % page and stock same size
\settypeblocksize{*}{35pc}{*} % {height}{width}{ratio}
\setlrmargins{*}{*}{1} % {spine}{edge}{ratio}
\setulmarginsandblock{1in}{1in}{*} % height of typeblock computed
\setheadfoot{\onelineskip}{2\onelineskip} % {headheight}{footskip}
\setheaderspaces{*}{1.5\onelineskip}{*} % {headdrop}{headsep}{ratio}
\checkandfixthelayout


\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{bbm}
\usepackage{accents}
\usepackage{newpxtext}
\usepackage{dutchcal}
\usepackage[utf8]{inputenc}
\usepackage[varg,bigdelims]{newpxmath}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{mathpartir}
\usepackage[bookmarks=true, colorlinks=true, linkcolor=blue!50!red, citecolor=orange,
pdfencoding=unicode]{hyperref}
\usepackage[capitalize]{cleveref}
  \newcommand{\creflastconjunction}{, and\nobreakspace}%Make cleveref use serial comma
\usepackage[backend=biber,style = alphabetic]{biblatex}
  \addbibresource{Library20200511.bib}

%%%% draft stuff
\usepackage[color=white]{todonotes}
\usepackage{showkeys}
\newcommand{\tob}[1]{\todo[color=blue!40,inline]{\textbf{T:} #1}\noindent}
\newcommand{\dis}[1]{\todo[color=red!40,inline]{\textbf{D:} #1}\noindent}



\usetikzlibrary{
	cd,
	math,
	decorations.markings,
	positioning,
	arrows.meta,
	shapes,
	calc,
	fit,
	quotes,
	intersections}
\hypersetup{final}
\setlist{nosep}

\tikzset{
  tick/.style={postaction={
    decorate,
    decoration={markings, mark=at position 0.5 with {\draw[-] (0,.4ex) -- (0,-.4ex);}}}
  },
  tickx/.style={
    postaction={ decorate,
      decoration={markings,
        mark=at position 0.5 with {
          \fill circle [radius=.28ex];
        }
      }
    }
  }
}

\crefalias{chapter}{section}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[chapter] %change [] to chapter if we want to change global numbering
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conjecture}[theorem]{Conjecture}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{construction}[theorem]{Construction}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{axiom}{Axiom}
\newtheorem{assumption}{Assumption}
\newtheorem*{axiom*}{Axiom}

\theoremstyle{remark}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{warning}[theorem]{Warning}
\newtheorem{question}[theorem]{Question}

% environment for soundness proofs
\newenvironment{soundproof}{\begin{proof}[Soundness proof]}{\end{proof}}

\setcounter{axiom}{0}

% Renewed commands

\renewcommand{\ss}{\subseteq}

% Macros %
\DeclarePairedDelimiter{\church}{\llbracket}{\rrbracket}
\DeclarePairedDelimiter{\Church}{\llbracket}{\rrbracket}
\DeclarePairedDelimiter{\subtype}{[}{]}
\DeclarePairedDelimiter{\classify}{\ulcorner}{\urcorner}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Mor}{Mor}
\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Ob}{Ob}
\DeclareMathOperator{\interior}{int}

\newcommand{\const}[1]{\mathtt{#1}}
\newcommand{\Set}[1]{\mathrm{#1}}
\newcommand{\cat}[1]{\mathcal{#1}}
\newcommand{\Cat}[1]{\mathbf{#1}}
\newcommand{\fun}[1]{\mathcal{#1}}
\newcommand{\Fun}[1]{\mathsf{#1}}
\newcommand{\sheaf}[1]{\fun{#1}}

\newcommand{\smset}{\Cat{Set}}


\newcommand{\tickar}{\begin{tikzcd}[baseline=-0.5ex,cramped,sep=small,ampersand replacement=\&]{}\ar[r,tick]\&{}\end{tikzcd}}
\newcommand{\xtickar}[1]{\stackrel{#1}{\tickar}}
\newcommand{\cocolon}{:\!}
\newcommand{\iso}{\cong}
\newcommand{\To}[1]{\xrightarrow{#1}}
\newcommand{\Too}[1]{\xrightarrow{\;\;#1\;\;}}
\newcommand{\from}{\leftarrow}
\newcommand{\From}[1]{\xleftarrow{#1}}
\newcommand{\Fromm}[1]{\xleftarrow{\;\;#1\;\;}}
\newcommand{\surj}{\twoheadrightarrow}
\newcommand{\inj}{\hookrightarrow}
\newcommand{\wavyto}{\rightsquigarrow}

\newcommand{\tn}[1]{\textnormal{#1}}
\newcommand{\ol}[1]{\overline{#1}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wh}[1]{\widehat{#1}}
\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}
\newcommand{\subsing}[1]{\mathrm{subsing}(#1)}	% subsingleton predicate
\newcommand{\conn}[1]{\mathrm{conn}(#1)}	% connectedness predicate
\newcommand{\ind}[1]{1_{#1}}
\newcommand{\inc}{\ind{-}}				% inclusion of Prop in lower reals

\newcommand{\internal}[1]{\raisebox{-.03ex}{$\mathbbmtt{#1}$}}
\renewcommand{\sec}{\sheaf{Sec}}


\newcommand{\hs}{\hspace{1.1pt}}


\newcommand{\EE}{\mathbb{E}} % expectation value
\newcommand{\II}{\mathbb{II}} % interval domain
\newcommand{\IR}{\mathbb{IR}} % interval domain
\newcommand{\nn}{\mathbb{N}}
\newcommand{\qq}{\mathbb{Q}}
\newcommand{\rr}{\mathbb{R}}
\newcommand{\zz}{\mathbb{Z}}
\newcommand{\LR}{\ul{\mathbb{R}}}

\newcommand{\tnn}{\internal{N}\hs}
\newcommand{\tqq}{\internal{Q}\hs}
\newcommand{\tqqint}{\internal{Q}\hs_{[0,1)}}
\newcommand{\tQQp}{\tQQ_{+}}
\newcommand{\tZZ}{\internal{Z}\hs}
\newcommand{\tQQub}{\QQ^\infty}
\newcommand{\trr}{\internal{R}\hs}
\newcommand{\tIR}{\internal{I\hs R}\hs}
\newcommand{\tii}{\ubar{\internal{I\hs\hs}}\!\hs}
\newcommand{\tlrr}{\ubar{\trr}\hs}
\newcommand{\trrub}{\trr^\infty}
\newcommand{\tIRub}{\internal{I\hs R}^\infty}
\newcommand{\tLRub}{\ubar{\trr}^{\infty}}
\newcommand{\tURub}{\bar{\trr}^{\infty}}
\newcommand{\tIIub}{\bar{\ubar{\trr}}^{\infty}}


\newcommand{\cast}{\textit{cast}}

\newcommand{\trrat}[1]{\trr_{\SeeInline{#1}}}

\newcommand{\pow}{\mathcal{P}}

\newcommand{\tConst}{\mathtt{C}}
\newcommand{\ShFun}[1]{\mathrm{Fn}(#1)}

\newcommand{\forces}{\Vdash}

\newcommand{\Ind}[1]{\Fun{Ind}\tn{-}#1}
\newcommand{\psh}{\Fun{Psh}}
\newcommand{\shv}{\Fun{Shv}}
\newcommand{\cont}{\Fun{Cont}}
\newcommand{\Idl}{\Set{Idl}}
\newcommand{\yoneda}{\Fun{y}}

\newcommand{\prop}{\const{Prop}}
\newcommand{\Time}{\const{Time}}
\newcommand{\Pt}{\const{Pt}}
\newcommand{\cc}{\const{cc}}
\newcommand{\unit}{\const{1}}
\newcommand{\Poset}{\Cat{Poset}}
\renewcommand{\Top}{\Cat{Top}}
\newcommand{\Op}{\Set{Op}}
\newcommand{\Open}{\Set{Open}}
\renewcommand{\C}{\Cat{C}}
\newcommand{\Sub}{\Set{Sub}}
\newcommand{\lsc}{\Fun{LsC}}

\newcommand{\op}{^\tn{op}}
\newcommand{\el}[1]{\tn{el}#1}
\newcommand{\asSh}{\Fun{Sh}} % sheafified object
\newcommand{\toSh}{\Fun{sh}} % sheafification map from object to sheafified object

\newcommand{\inv}{^{-1}}

\newcommand{\cpct}[1]{\Set{Cpct}_{#1}}
\newcommand{\pt}{k}				% point indexing our At-modalities
\newcommand{\Pts}{\mathcal{Pts}}		% internal type of points (for indexing the At-modalities)
\newcommand{\decmod}{\mathcal{DMod}}
\newcommand{\bas}[1]{\wh{#1}}


\newcommand{\apart}{\,\#\,}
\newcommand{\rest}[2]{#1\big|\hspace{0in}_{#2}}
\newcommand{\restsm}[2]{#1|\hspace{0in}_{#2}}
\newcommand{\BaseTopos}{\mathcal{B}}
\newcommand{\BaseSpace}{B}
\newcommand{\CB}{C\BaseSpace}
\newcommand{\Const}{\Fun{Const}}
\newcommand{\Sky}{\Fun{Sky}}

\newcommand{\Pointwise}{\pi}
\newcommand{\AtSymbol}{{@}}
\newcommand{\SeeSymbol}{{\down}}  % Old: \xi
\newcommand{\InSymbol}{{\upclose}}% Old: \iota
\newcommand{\At}[1][\pt]{\AtSymbol_{#1}}
\newcommand{\See}[2][]{\SeeSymbol^{#1}_{#2}}
\newcommand{\In}[2][]{\InSymbol^{#1}_{#2}}
\newcommand{\AtInline}[1]{@{#1}}
\newcommand{\SeeInline}[1]{\SeeSymbol{#1}}
\newcommand{\InInline}[1]{\InSymbol{#1}}


\newcommand{\sqss}{\sqsubseteq}
\newcommand{\specupclose}{{\uparrow}}
\newcommand{\specdownclose}{{\downarrow}}
\newcommand{\upclose}{{\rotatebox[origin=c]{90}{$\twoheadrightarrow$}}}
\newcommand{\downclose}{{\rotatebox[origin=c]{90}{$\twoheadleftarrow$}}}
\newcommand{\down}{\mathord{\downarrow}}
\newcommand{\up}{\mathord{\uparrow}}

\newcommand{\imp}{\Rightarrow}
\renewcommand{\iff}{\Leftrightarrow}
\newcommand{\true}{\top}
\newcommand{\false}{\bot}
\newcommand{\Bool}{\Set{Bool}}
\newcommand{\ev}{\fun{ev}}

\newcommand{\Span}{\Cat{Span}}
\newcommand{\set}{\text{--}\smset}

\newcommand{\qand}{\quad\tn{and}\quad}
\newcommand{\qqand}{\qquad\tn{and}\qquad}

\newcommand{\adj}[5][30pt]{%[size] Cat L, Left, Right, Cat R.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=5pt, "{#3}"]\ar[r, phantom, "\Rightarrow" yshift=-.4pt]\&
  #5\ar[l, shift left=5pt, "{#4}"]
\end{tikzcd}
}

\newcommand{\adjr}[5][30pt]{%[size] Cat R, Right, Left, Cat L.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=5pt, "{#3}"]\ar[r, phantom, "\Leftarrow" yshift=-.6pt]\&
  #5\ar[l, shift left=5pt, "{#4}"]
\end{tikzcd}
}


\newcommand{\erase}[1]{}

\linespread{1.2}
\setsecnumdepth{subsection}
\settocdepth{section}
\setlength{\parindent}{15pt}

% ================ Document ================%
\begin{document}

\title{Stochastic Processes as Internal Probability Valuations}
\author{Tobias Fritz and David I.\ Spivak}
\date{\vspace{-.3in}}

\maketitle

% ======== Abstract ========%
\begin{abstract}

\end{abstract}

%\tableofcontents*


% ======== Chapter ========%
\chapter{Introduction}

Entities we observe---either casually or as scientists---exhibit time-varying behavior that we may wish to model. We may be able to monitor the entity with respect to a collection of variables whose values change as the entity performs various actions. The variables we monitor for a weather system are quite different than those we monitor for a mouse, but in each case we notice that the variables take on certain characteristic patterns as they change through time. The better we can understand and model the entity's behavior patterns, the better we are able to predict and have some degree of control when we interact with the entity.

The characteristic patterns of an entity can be formalized using a stochastic process \cite{doob1934stochastic}. For example Brownian motion as developed by Albert Einstein to model the random movement of pollen particles in water \cite{einstein1956investigations}, was later formalized by Norbert Weiner as a stochastic process. Given a measurable space $S$ (the \emph{state space}) and a set $T$ (the \emph{time line}), a stochastic process can be defined as a probability distribution $p$ on $S^T$, the measurable space of functions $s\colon T\to S$. Each such $s$ is a behavior, and the stochastic process tells us the probability that any given measurable set of behaviors will occur.

A version of the Kolmogorov extension theorem (KET) roughly says that we can reconstruct such a stochastic process $p$ from its finite marginals. That is, for each finite subset $F\ss T$ there is a measurable function $\pi^{T\from F}\colon S^T\to S^F$, and we can push forward $p$ to a probability measure $\pi^{T\from F}_*(p)$ on $S^F$. Given $F'\ss F$, we of course have compatibility $\pi^{T\from F'}_*(p)=\pi^{T\from F}_*\circ\pi^{F\from F'}_*(p)$. The KET says that if we instead have a compatible family of probability measures $p_F$ on $S^F$ for all finite $F\ss T$, then there is a unique probability measure $p$ on $S^T$ such that $p_F=\pi^{T\from F}_*(p)$. Here is a more category-theoretic version.

\begin{theorem}[Kolmogorov extension theorem]
The functor of Radon measures on a suitable category of spaces (completely regular Hausdorff) commutes with cofiltered limits.
\end{theorem}
\begin{proof}
\cite[Theorem 2.5]{danos2015dirichlet}
\end{proof}



The authors were led to this subject by considering the same guiding question---that of understanding characteristic patterns of behavior---within a different mathematical model. In particular, \emph{temporal type theory} \cite{schultz2019temporal} studies various types of behavior category theoretically, using sheaves on a space of time intervals. Such sheaves form a topos $\cat{B}$ and one can use the internal language of the topos to make statements, written in a logical style, about how various entities will behave. We were interested in the question of whether probabilistic statements could also be made within that internal language. In particular, we asked the question: do internal valuations on $\cat{B}$ coincide with stochastic processes?

In attempting to answer that question, we found it helpful to generalize the statement, in particular the spaces on which it holds. 

% ==== Section ====%
\section{Plan of the paper}
In \cref{chap.background}


\section*{Acknowledgements}
David Spivak acknowledges the support from Honeywell and from AFOSR grants FA9550-17-1-0058 and FA9550-19-1-0113.



% ======== Chapter ========%
\chapter{Background}\label{chap.background}

For background on sheaves, toposes, internal logic, and modalities, see \cref{sec.topos_background}.

% ==== Section ====%
\section{Lower nonnegative reals}

\begin{definition}[Lower nonnegative reals]\label{def.lower_nn_reals}
We define a \emph{lower nonnegative real} to be a function $r_>\colon\tqq\to\prop$ satisfying the following axioms:%
\footnote{Here $r_>$ is just a symbol, but it reminds the reader that a lower real is defined as a set of rational ``lower bounds''.}
\begin{enumerate}
	\item (nonnegative) $\forall(q:\tqq).0>q\imp r_>q$.
	\item (down-closed) $\forall(q,q':\tqq). r_>q'\imp q'>q\imp r_>q$.
	\item (rounded) $\forall (q:\tqq).r_>q\imp\exists (q':\tqq).q'>q\wedge r_>q'$.
\end{enumerate}
Define the \emph{type of lower nonnegative reals}, denoted $\tlrr$, to be
\[\tlrr\coloneqq\{r_>\colon\tqq\to\prop\mid r_>\tn{ nonnegative, down-closed, rounded}\}.
\]
We often abuse notation and write $r>q$ or $q<r$ to mean the proposition $r_>(q)$. We often refer to lower nonnegative reals simply as \emph{lower reals}.
\end{definition}

\begin{definition}[$\tqq_{\geq0}$-action on lower reals]\label{def.Q_action}
For any $r:\tlrr$ and $q\in\tqq$ with $0\leq q$, define $q\cdot r:\tqq\to\prop$ by cases.
\[
(q\cdot r)_>q'\coloneqq
\begin{cases}
	0>q'&\tn{ if }q=0\\
	r>q'/q&\tn{ if }q>0.
\end{cases}
\]
We show that $q\cdot r$ is a lower real in \cref{prop.Q_action_lower_real}.
\end{definition}

\begin{proposition}\label{prop.Q_action_lower_real}
For any $r:\tlrr$ and $q\in\tqq$ with $0\leq q$, the predicate $q\cdot r$ from \cref{def.Q_action} is a lower real.
\end{proposition}
\begin{proof}
If $q=0$ then $(q\cdot r)>q'$ iff $0>q'$, so $q\cdot r$ is clearly nonnegative, down-closed, and rounded. Suppose $q>0$. If $0>q'$ then $0>q'/q$ so $r>q'/q$ and $r>q'$; hence it is nonnegative. Proving down-closure and roundedness are similarly straightforward.
\end{proof}

We now want to define order and addition of lower reals, as well as the inclusion of rational numbers and propositions as special lower reals.

\begin{definition}[Order on lower reals]
Given lower reals $r,r'$,
%we say that $r$ \emph{is greater than} $r'$ and write $r>r'$ to denote the following proposition:
%\[
%	r>r'\coloneqq\exists (q:\tqq).r>q\wedge\forall(q'.\tqq).r'>q'\imp q>q'.
%\]
we say that $r$ \emph{is above} $r'$ and write $r\geq r'$ to denote the following proposition:
\begin{equation}\label{eqn.real_order}
	r\geq r'\coloneqq\forall(q:\tqq).r'>q\imp r>q.
\end{equation}
We may write $r'\leq r$ to denote $r\geq r'$.
\end{definition}

The following is straightforward when working in the internal logic; for more on this see \cref{sec.logic,sec.internal_language,sec.modalities}.

\begin{proposition}[$\geq$ is a partial order]
For all lower reals $r,r',r'':\tlrr$, we have
\begin{enumerate}
	\item $r\geq r$
	\item $(r\geq r')\imp(r'\geq r'')\imp(r\geq r'')$
	\item $(r\geq r')\imp(r'\geq r)\imp r=r'$
\end{enumerate}
\end{proposition}

\begin{definition}[Addition of lower reals]\label{def.sum_lr}
Let $r_1,r_2:\tlrr$ be lower reals. Define their \emph{sum}, denoted $(r_1+r_2)_>:\tqq\to\prop$ to be the predicate
\begin{equation}\label{eqn.sum_lr}
(r_1+r_2)_>q\coloneqq\exists (q_1,q_2:\tqq).(r_1>q_1)\wedge (r_2> q_2)\wedge (q=q_1+q_2).
\end{equation}
We show it is indeed a lower real in \cref{prop.sum_lr}.
\end{definition}

\begin{proposition}\label{prop.sum_lr}
The predicate $(r_1+r_2)_>$ defined in \cref{def.sum_lr} is a lower real.
\end{proposition}
\begin{proof}
We need to show that $(r_1+r_2)_>$ is nonnegative, down-closed, and rounded.

\noindent (Nonnegative): If $0>q$, take $q_1=q_2\coloneqq q/2$. Then $q_1+q_2=q$ and $r_1>q_1$ and $r_2>q_2$ by assumption, so $r_1+r_2>q$.

\noindent(Down-closed): Choose rationals $q'>q$ with $r_1+r_2>q'$. By definition we have $q_1',q_2'$ with $r_1>q_1'$ and $r_2>q_2'$ and $q'=q_1'+q_2'$. Let $\varepsilon\coloneqq (q'-q)/2$ and for each $i=1,2$, let $q_i\coloneqq q_i'-\varepsilon$. Then $r_1>q_1$ and $r_2>q_2$ and $q=q_1+q_2$, so $r_1+r_2>q$ as desired.

\noindent(Rounded): Choose a rational $q$ and suppose $(r_1+r_2)>q$. By definition we have $q_1,q_2$ with $r_1>q_1$ and $r_2>q_2$ and $q=q_1+q_2$. By roundedness of $r_1$ and $r_2$, we have rationals $q_1',q_2'$ with $r_1>q_1'>q_1$ and $r_2>q_2'>q_2$. Then letting $q'=q_1'+q_2'$, we have $(r_1+r_2)>q'$ and $q'>q$, as desired.
\end{proof}

\begin{lemma}\label{lemma.sums_bigger}
For any $q:\tqq$ and $r,r':\tlrr$, if $q<r$ then $q<r+r'$.
\end{lemma}
\begin{proof}
Take $q<r$ and use roundedness to produce $q<q'<r$. Then $q-q'<0<r'$ so $q=q'+(q-q')<r+r'$ as desired.
\end{proof}


\begin{definition}[Pairwise minima, arbitrary suprema]\label{def.min_sup}
Let $r,r':\tlrr$. We define their \emph{minimum}, denoted $\min(r,r')$ by
\[q<\min(r,r') \iff (q<r)\wedge(q<r').\]

Let $I\in\cat{E}$ be an object and $r:I\to\tlrr$ be an $I$-indexed family of lower reals. Its \emph{supremum}, denoted $\sup_{i:I}r_i:\tlrr$ is the lower real defined  by 
\[q<\sup_{i:I}r_i\iff (q<0)\vee\exists(i:I).(q<r_i).\]
\end{definition}

\begin{proposition}
Pairwise minima and arbitrary suprema of lower reals are indeed lower reals.
\end{proposition}
\begin{proof}
We leave the first claim to the reader. If $r$ is an $I$-indexed family of lower reals, then $r\coloneqq\sup_{i:I}r_i$ is nonnegative by construction. To see that it is down-closed and rounded, suppose $q<r$ and $q_0<q$. There exists $i:I$ with $q<r_i$. But since $r_i:\tlrr$, it is down-closed and rounded so we have $q_0<r_i$, and there exists some $q'<r_i$ with $q<q'$. It follows that $q_0<r$ and $q'<r$ as required.
\end{proof}

It is easy to check that $\min(r,r')$ as defined in \cref{def.min_sup} is indeed a minimum (greatest lower bound) of $r,r'$ and that $\sup_{i:I}r_i$ is indeed a supremum (least upper bound) of $(r_i)_{i\in I}$. That is, $\forall(j:I).(r_j\leq\sup_{i:I}r_i)$ and if $\forall(i:I).r_i\leq r$ then $\sup_{i:I}r_i\leq r$.


\begin{definition}[Rationals ``are'' lower reals]\label{def.rationals_are_reals}
Let $\tqq_{\geq0}\coloneqq\{q:\tqq\mid q\geq0\}$. There is a function $\tqq_{\geq0}\to\tlrr$ sending $q$ to the predicate $q_>\colon\tqq\to\prop$ given by $q_>q'\coloneqq q>q'$.%
\footnote{We leave it to the reader to check that $q_>$ is indeed a lower real.}
 We often write $q:\tlrr$ to denote this lower real.
\end{definition}


We leave the following to the reader.
\begin{proposition}
The inclusion of nonnegative rationals into lower reals from \cref{def.rationals_are_reals} preserves order and sum.
\end{proposition}

\begin{proposition}
The lower reals form a commutative monoid $(\tlrr,0,+)$.
\end{proposition}
\begin{proof}
\noindent (Commutativity): obvious from the definition \eqref{eqn.sum_lr}.

\noindent (Unitality): First we show that $r>q$ implies $r+0>q$. By roundedness, take $r>q'>q$ and let $q_0=q-q'$. Then $r>q'$, $0>q_0$, and $q=q'+q_0$, so $r+0>q$. Second we show that $r+0>q$ implies $r>q$. By definition there exists $q_1,q_2$ with $r>q_1$, $0>q_2$, and $q=q_1+q_2$. But then $r>q_1>q_1+q_2=q$.

\noindent (Associativity): Both sides of associativity $(r_1+r_2)+r_3=^?r_1+(r_2+r_3)$ are directly seen to be equivalent to the formula $\exists(q_1,q_2,q_3:\tqq).(r_1>q_1)\wedge(r_2>q_2)\wedge(r_3>q_3)\wedge(q=q_1+q_2+q_3)$.
\end{proof}

\begin{lemma}\label{lemma.rational_cancellativity}
For all $q,q':\tqq$ and $r:\tlrr$, if $q'+q<q'+r$ then $q<r$.
\end{lemma}
\begin{proof}
By \cref{def.sum_lr}, there exist rational $q'_0<q'$ and $q_0<r$ such that $q'_0+q_0=q'+q$. Thus we have $q<q+q'-q'_0=q_0<r$.
\end{proof}

\begin{proposition}\label{prop.cancel_rationals}
For all $q:\tqq$ and $r_1,r_2:\tlrr$, if $q+r_1\leq q+r_2$ then $r_1\leq r_2$.
\end{proposition}
\begin{proof}
Take $q_1<r_1$; we want to show $q_1<r_2$. Use roundedness to produce $q_1<q_1'<r_1$, and let $q_0\coloneqq q+q_1-q_1'$. We have $q_0<q$ and hence $q+q_1=q_0+q_1'<q+r_1$, and the result follows from \cref{lemma.rational_cancellativity}
\end{proof}

\begin{definition}[Indicator functions as lower reals]\label{def.props_are_reals}
There is a function $\prop\to\tlrr$ sending $P:\prop$ to the function $\ind{P}\colon\tqq\to\prop$ given by:%
\footnote{We leave it to the reader to check that $\ind{P}$ is indeed a lower nonnegative real.}
\[\ind{P}(q)\coloneqq(q<0)\vee ((q<1)\wedge P).\]
\end{definition}

Combining \cref{def.props_are_reals,def.rationals_are_reals}, we have for any $P:\prop$ and $r:\tlrr$
\begin{equation}\label{eqn.indicator}
P\imp (\ind{P}+r=1+r).
\end{equation}

The following is straightforward.
\begin{lemma}\label{lemma.ind_monotonic}
We have $\ind{\bot}=0$, $\ind{\top}=1$, and if $P\imp Q$ then $\ind{P}\leq\ind{Q}$.
\end{lemma}

\begin{lemma}\label{lemma.j_indicator}
Let $j$ be a modality. Then for any $P:\prop$ we have $j\ind{P}=j\ind{jP}$.
\end{lemma}
\begin{proof}
Clearly $j\ind{P}\leq j\ind{jP}$ so we prove the other inequality. We assume $j(q<\ind{jP})$ and want to prove $j(q<\ind{P})$, so we may strengthen the hypothesis to $q<\ind{jP}$. Thus $(q<0)\vee((q<1)\wedge jP)$; if $q<0$ then $q<\ind{P}$ and we're done. If $(q<1)\wedge jP$ then we can strengthen the hypothesis and get $(q<1)\wedge P$, giving $q<\ind{P}$ and hence $j(q<\ind{P})$ as desired.
\end{proof}

We want to show order cancellativity, \cref{cor.order_cancel}. To do so we follow a proof of Simon Henry \cite{henry2012simplification}.

\begin{lemma}\label{lemma.order_cancel_props}
For any $P:\prop$ and $r_1,r_2:\tlrr$, if $\ind{P}+r_1\leq \ind{P}+r_2$ then $r_1\leq r_2$.
\end{lemma}
\begin{proof}
Suppose $q_1<r_1$. Then by \cref{lemma.sums_bigger}, $q_1<\ind{P}+r_1$ so by assumption $q_1<\ind{P}+r_2$. By \cref{def.sum_lr}, there exist $q<\ind{P}$ and $q_2<r_2$ with $q_1=q+q_2$. There are two cases: $q<0$ or $(q<1)\wedge P$. If $q<0$ then $q_1=q+q_2<q_2<r_2$, as desired. In the second case, we have $P$ so by \cref{eqn.indicator,prop.cancel_rationals}, $\ind{P}+r_1\leq \ind{P}+r_2$ directly implies $r_1\leq r_2$.
\end{proof}

\begin{lemma}[\cite{henry2012simplification}]\label{lemma.cancellative_bounds}
Let $r:\tlrr$ be bounded by some $N:\tnn$, i.e. $r<N$. For any $n:\tnn$ with $n\geq 1$, there exists $r_n:\tlrr$ satisfying the following
\begin{enumerate}
	\item $r_n\leq r\leq r_n+1/n$; and
	\item for any $a,b:\tlrr$ if $r_n+a\leq r_n+b$ then $a\leq b$.
\end{enumerate}
\end{lemma}
\begin{proof}
Define $r_n:\tlrr$ to be the following linear combination of indicator functions:
\begin{equation}\label{eqn.cancellative_bounds}
r_n\coloneqq \frac{1}{n}\cdot\sum_{i=1}^{n\cdot N}\ind{(i/n)<r}.
\end{equation}
For the claim that $r_n\leq r$, take $q<r_n$; we will show $q<r$. By \cref{def.Q_action,def.sum_lr}, we have $nq=q_1+\cdots+q_{nN}$ with $q_i<0$ or $(q_i<1)\wedge (i/n<r)$ for each $i$. Let $i_r$ be the largest $i$ with $0<q_i$. Then $i_r/n<r$ and hence for all $i\leq i_r$ we have $i/n<r$, so $q_i<1$, and for all $i>i_r$ we have $q_i<0$. It follows that $nq<i_r$, i.e.\ that $q<i_r/n<r$, as desired.

For the claim that $r\leq r_n+1/n$, take $q<r$; we will show $q<r_n+1/n$ or equivalently $nq<nr_n+1$. Let $n_0\coloneqq\floor{nq}$ be the largest integer with $n_0\leq nq$. Then $nq<n_0+1$ and it suffices to show that $n_0\leq nr_n=\sum_{i=1}^{nN}\ind{(i/n)<r}$. Since $q<r$ we have $i/n<r$, and hence $\ind{(i/n)<r}=1$ for all integers $1\leq i\leq n_0$. This gives $n_0\leq nr_n$ as desired.

Finally, suppose $r_n+a\leq r_n+b$. Then $nr_n+na\leq nr_n+nb$ and it follows by induction on $Nn$ using \cref{lemma.order_cancel_props} that $na\leq nb$. Hence $a\leq b$.
\end{proof}

\begin{corollary}[Order cancellativity, \cite{henry2012simplification}]\label{cor.order_cancel}
Suppose $r,s,s':\trr$ are lower reals and that $r<N$ is bounded by $N:\tnn$. If $r+s\leq r+s'$ then $s\leq s'$.
\end{corollary}
\begin{proof}
Suppose $r+s\leq r+s'$; to conclude $s\leq s'$ we take $q<s$ and wish to prove $q_1<s'$. By roundedness, take $q<q'<s$, let $n:\tnn$ be an integer with $1/n<q'-q$, and let $r_n$ be as in \eqref{eqn.cancellative_bounds}. Then by \cref{lemma.cancellative_bounds}, we have 
\[r_n+s\leq r+s\leq r+s'\leq r_n+s'+1/n,\]
and moreover we can conclude $s\leq s'+1/n$. But then $q+1/n<q'<s\leq s'+1/n$ and the result follows from \cref{prop.cancel_rationals}.
\end{proof}

\begin{corollary}\label{cor.favorite}
For all $r_1,r_2,r_1',r_2':\tlrr$, suppose $r_1+r_2=r_1'+r_2'$. If $r_1\leq r_1'$ and $r_2\leq r_2'$ then $r_1=r_1'$ and $r_2=r_2'$.
\end{corollary}
\begin{proof}
If $r_1\leq r_1'$ then $r_1+r_2'\leq r_1'+r_2'=r_1+r_2$, so $r_2'\leq r_2$ by \cref{cor.order_cancel}. The second assumption $r_2\leq r_2'$ implies $r_2=r_2'$, and similarly we find $r_1=r_1'$.
\end{proof}

\begin{proposition}\label{prop.commute_exists_commute_addition}
Suppose $j\exists(q:\tqq).P(q)\imp \exists(q:\tqq).jP(q)$ holds for every $P:\tqq\to\prop$. Then $j$ commutes with addition of lower reals
\[
	jr_1+jr_2=j(r_1+r_2).
\]
\end{proposition}
\begin{proof}
More precisely, we need to show that for all $q:\tqq$ we have
\begin{multline*}
	\exists(q_1,q_2:\tqq).(q=q_1+q_2)\wedge j(q_1<r_1)\wedge j(q_2<r_2)\iff\\
	j(\exists(q_1,q_2:\tqq).(q=q_1+q_2)\wedge (q_1<r_1)\wedge(q_2<r_2)).
\end{multline*}
For any modality $j$, any type $X$, and any $P:X\to\prop$ we have $\exists(x:X).jP(x)\imp j\exists(x:X).P(x)$. The $\imp$ implication follows immediately.

For $\Leftarrow$, assume $j(\exists(q_1,q_2:\tqq).(q=q_1+q_2)\wedge (q_1<r_1)\wedge(q_2<r_2))$. By the commutivity of $j$ with $\exists$, we have $\exists(q_1,q_2:\tqq).j(q=q_1+q_2)\wedge j(q_1<r_1)\wedge j(q_2<r_2)$. Now equality of rationals is decidable so either $q=q_1+q_2$, in which case we are done, or $\neg(q=q_1+q_2)$. In the latter case we obtain $j\bot$, at which point the desired statement $\exists(q_1,q_2:\tqq).(q=q_1+q_2)\wedge j(q_1<r_1)\wedge j(q_2<r_2)$ holds using $q_1=q$ and $q_2=0$.
\end{proof}

\begin{corollary}\label{cor.closed_sum}
Suppose $j\exists(q:\tqq).P(q)\imp \exists(q:\tqq).jP(q)$ holds for every $P:\tqq\to\prop$. Then for any $r_1,r_2:\tlrr$, the sum $r_1+r_2$ is $j$-closed iff $r_1$ and $r_2$ are.
\end{corollary}
\begin{proof}
Given the assumption that $j$ commutes with $\exists$, it is easy to check that if $r_1$ and $r_2$ are $j$-closed then so is $r_1+r_2$. For the converse, we begin by noting that $r_1\leq jr_1$ and $r_2\leq jr_2$. Now by \cref{prop.commute_exists_commute_addition}, if $r_1+r_2=j(r_1+r_2)$ then $r_1+r_2=jr_1+jr_2$, and the result follows from \cref{cor.favorite}.
\end{proof}

% ==== Section ====%
\section{The lower unit interval $[0,1]$}

We will work extensively with elements of the unit interval, and it will be convenient to give it a special definition. Let $\tqqint\coloneqq\{q:\tqq\mid 0\leq q< 1\}$.

\begin{definition}\label{def.unit_interval}
The \emph{unit interval}, denoted $\tii$ is defined to be the type of functions $r_>\colon\tqqint\to\prop$ satisfying
\begin{equation}\label{eqn.down_closed_rounded_for_interval}
	\forall(q:\tqqint).r_>q\iff\exists(q':\tqqint).(r_>q')\wedge (q'>q).
\end{equation}
As usual we write $q<r$ or $r>q$ to denote the proposition $r_>q$.
\end{definition}

The following is straightforward to prove.
\begin{proposition}\label{prop.unit_interval_cast}
There is a pair of maps $a\colon\tlrr\to\tii$ and $\cast\colon\tii\to\tlrr$ given by
\[
a(r)>q\iff r>q
\qqand
\cast(r')>q\iff (q<0)\vee\big((q<1)\wedge q<r'\big)
\]
that form a retraction: $a(\cast(r'))=r'$ for any $r'\in\tii$. In the other direction, $\cast(a(r))=\min(r,1)$.
\end{proposition}

\begin{definition}\label{def.sup_unit_interval}
For any $I\in\shv(E)$ and $r\colon I\to\tii$, define $\sup_{i:I}r_i$ to be the predicate $\tqqint\to\prop$ given by
\[
q<\sup_{i:I}r_i\iff \exists(i:I).(q<r_i).
\]
\end{definition}

The proofs of \cref{prop.cast_sups,prop.inc_const} are straightforward.
\begin{proposition}\label{prop.cast_sups}
For any $I\in\shv(E)$ and $r\colon I\to\tii$, we have $\cast(\sup_{i:I}r_i)=\sup_{i:I}\cast(r_i).$
\end{proposition}

\begin{proposition}\label{prop.inc_const}
The morphism $\inc\colon\prop\to\tlrr$ factors as
\[
\begin{tikzcd}
	\prop\ar[r, "\textit{const}\ P"]&[5pt]
	\tii\ar[r, "\cast"]&
	\tlrr
\end{tikzcd}
\]
where $(\textit{const}\ P)\colon\tqqint\to\prop$ is the constant at $P$.
\end{proposition}
We denote $\textit{const}\ P$ simply by $\ind{P}\colon\tqqint\to\prop$.


% ==== Section ====%
\section{$j$-local lower reals}

\dis{Do we need this?}
\tob{yes, this is essential!}

Let $j:\prop\to\prop$ be a modality and $\prop_j$ the type of $j$-closed propositions  (see \cref{def.modality,def.j_closed_props}). We follow \cite[Definition 4.21]{schultz2019temporal} in the following definition (see also loc.\ cit.\ Remark 4.9).

\begin{definition}[$j$-local lower nonnegative reals]\label{def.j_loc_lower_reals}
The \emph{$j$-local lower nonnegative reals}, denoted $\tlrr_j$, is the type of functions $r_>\colon\tqq\to\prop_j$ satisfying the following axioms:
\begin{enumerate}
	\item (nonnegative) $\forall(q:\tqq).0>q\imp r_>q$.
	\item (down-closed) $\forall(q,q':\tqq). r_>q'\imp q'>q\imp r_>q$.
	\item ($j$-rounded) $\forall (q:\tqq).r_>q\imp j\exists (q':\tqq).q'>q\wedge r_>q'$.
\end{enumerate}
\end{definition}

Note that, using decidability of the order on $\tqq$, it follows that the nonnegativity and down-closure properties are automatically $j$-closed. A similarly simple argument shows that also the $j$-roundedness condition is $j$-closed.

Moreover, if $j$ commutes with existential quantification over $\tqq$, then the $j$ can be left out of the roundedness condition entirely; in this case, a $j$-local real is simply a lower real which is $j$-closed as a predicate on the rationals.

\tob{I've been sloppy by ignoring the nonnegativity condition (for now), but fortunately it's also automatically $j$-closed}

% ==== Section ====%
\section{Internal topological spaces and Moerdijk's theorem}


Recall that for a sheaf $X$, the sheaf of subobjects $\pow(X)$ is defined to be $\prop^X$. \cref{def.internal_space} returns the usual notion of topological space, when $\cat{E}=\smset$.

\begin{definition}\label{def.internal_space}
Let $X\in\cat{E}$ be an object, let $\Open_X\colon\pow(X)\to\prop$ be a predicate on $\pow(X)$, and write $\Op_X\coloneq\{U:\pow(X)\mid\Open_X(U)\}$. We say $(X,\Op_X)$ is an \emph{internal topological space in $\cat{E}$} (and $\Op_X$ is a \emph{topology on $X$}) whenever the following conditions hold:
\begin{enumerate}
	\item $\Open_X(\top)$,
	\item $\Open_X(\bot)$,
	\item $(\Open_X(U)\wedge\Open_X(V))\imp \Open_X(U\wedge V)$ for any $U,V\in\pow(X)$, and
	\item $\big(\forall(i:I).\Open_X(U_i)\big)\imp\Open_X\big(\exists(i:I).U_i\big)$ for any $I\in\cat{E}$ and $U\colon I\to\pow(X)$.
\end{enumerate}
The fourth condition can also be restated as follows:
\begin{enumerate}[label=4'.]
	\item $\Open(\exists(P:\Op_X).S(P)\wedge P)$ for any $S\colon\Op_X\to\prop$. 
\end{enumerate}
\begin{enumerate}[label=4''.]
	\item $\Open(\exists(P:S).P)$ for any $S\ss\Op_X$.
\end{enumerate}

A \emph{morphism of internal topological spaces} (also called a \emph{continuous map}) is a function $f\colon X\to Y$ such that $\Open_Y(U)\imp\Open_X(f\inv(U))$ holds for any $U\ss X$. We denote the category of internal topological spaces as $\Top_\cat{E}$.
\end{definition}

\begin{proposition}
In \cref{def.internal_space}, conditions 4, 4', and 4'' are equivalent.
\end{proposition}
\begin{proof}
Clearly 4'$\iff$ 4''. We first show $4\imp 4'$. Given $S\colon\Op_X\to\prop$, define $I\coloneqq\{P:\Op_X\mid S(P)\}$ and $U\colon I\to\pow(X)$ by $U(P)\coloneqq P$. Then $\forall(i:I).\Open_X(U_i)$ holds, so by 4 we have $\Open_X(\exists(i:I).U_i)$, which is equivalent to $\Open_X(\exists(P:\Op_X).S(P)\wedge P)$, as desired.

For $4'\imp 4$, take $I\in\cat{E}$ and $U\colon I\to\pow(X)$, and assume $\forall(i:I).\Open_X(U_i)$. Let $S\colon\Op_X\to\prop$ be given by $S(V)\coloneqq\exists(i:I).V=U_i$. By 4' we have that $\exists(P:\Op_X).S(P)\wedge P$, which is equivalent to $\exists(P:\Op_X)(i:I).(P=U_i)\wedge P$, which in turn is equivalent to $\exists(i:I).U_i$, is open as desired.
\end{proof}

The fourth condition is a powerful assumption with the following surprising consequences.

\begin{lemma}
	\label{props_open}
	Let $(X,\Op_X)$ be an internal topological space. Then:
	\begin{enumerate}
		\item For every open $U : \Op_X$ and every modality $j$, also $jU$ is open.
		\item For every $P : \prop$, the constant predicate $x \mapsto P$ is open.
	\end{enumerate}
\end{lemma}

\begin{proof}
	\begin{enumerate}
		\item Consider the join $J$ of the predicate $S : \Op_X \to \prop$ given by
			\[
				S(Q) \: := \: j(Q \Rightarrow U).
			\]
			This join, which is open by 4', is given by
			\[
				J\coloneqq\exists(Q : \Op_X) . j(Q \Rightarrow U) \land Q.
			\]
			It remains to show $J=jU$. The implication $J\imp jU$ follows easily from \cref{def.modality} (def.\ of modality); its converse $jU\imp J$ holds by taking $Q := \top$.
		\item Apply the previous statement to the open $U\coloneqq\bot$ and the closed modality $j\coloneqq P \lor -$. \qedhere
	\end{enumerate}
\end{proof}

\begin{corollary}\label{cor.top_on_one}
There is precisely one topology on the terminal object $*\in\cat{E}$, and $*$ is terminal in $\Top_\cat{E}$.
\end{corollary}
\begin{proof}
We have $\pow(*)=\prop$ and it is a topology because by definition $\Open(P)$ holds for every $P:\prop$. It is unique by \cref{props_open} (2). There is a unique function $X\to *$ for every $X$ and it is continuous, so $*$ is terminal.
\end{proof}

Recall from \cref{prop.local_homeo} that there is an equivalence between the category $\shv(T)$ of sheaves on a topological space $T$ and that of local homeomorphisms over $T$.

\begin{theorem}[{\cite[Theorem 1.5]{moerdijk1984spaced}}]
Let $T$ be a topological space, $X\in\shv(T)$ a sheaf on it, and $p\colon E_X\to T$ the corresponding local homeomorphism. Then there is a one-to-one correspondence between internal topologies $\Op$ on $X$ and diagrams of topological spaces
\[
\begin{tikzcd}
	E_X\ar[dr, "p"']\ar[rr, "c^{\Op}"]&&
	E_X^{\Op}\ar[dl, "p^{\Op}"]\\&
	T
\end{tikzcd}
\]
for which the map $c$ is identity on points.
\end{theorem}

We do not give the proof here, but explain a bit how internal topologies

% ==== Section ====%
\section{Valuations}\label{sec.valuations}

\begin{definition}[Directed poset]\label{def.directed}
Let $(P,\leq)$ be an internal poset in $\cat{E}$ (\cref{def.internal_poset}). It is \emph{directed} if it satisfies
\begin{enumerate}
	\item $\exists(p:P).\top$, and
	\item $\forall(p,p':P).\exists(q:P).(p\vee p')\imp q$.
\end{enumerate}
\end{definition}


Recall the lower unit interval type $\tii$ from \cref{def.unit_interval}. We may implicitly cast $r:\tii$ as a lower real using the function $\cast\colon\tii\to\tlrr$ from \cref{prop.unit_interval_cast}. For example in the modular condition (3) below, the expression $r+r'$ on either side of the equation is shorthand $\cast(r)+\cast(r')$. However condition (3) is the only place where we need to invoke $\cast$; e.g.\ in the continuity condition (4), recall from \cref{prop.cast_sups} that the $\sup$ can be computed in $\tii$.

\begin{definition}[Probability valuation]
Let $(X,\Op_X)$ be an internal topological space. A \emph{probability valuation} on $(X,\Op_X)$ is a function $\mu\colon\Op_X\to\tii$ satisfying the following conditions:
\begin{enumerate}
	\item $\mu(\bot)=0$ and $\mu(\top)=1$;
	\item $(U\imp V)\imp\mu(U)\leq\mu(V)$; and
	\item $\mu(U)+\mu(V)=\mu(U\cup V)+\mu(U\cap V)$.
	\item If $D\ss\Op_X$ is a directed subposet (\cref{def.directed}), then
	\begin{equation}\label{eqn.scott_continuity}
	\sup_{U: D}\mu(U)=\mu\big(\exists(U:D).U\big).
	\end{equation}
\end{enumerate}
\end{definition}


\begin{proposition}[Push-forward valuation]\label{prop.pushforward}
Suppose that $f\colon X\to Y$ is a continuous map of internal topological spaces. Then for any valuation $\mu$ on $X$, the function $f_*\mu\colon\Op_Y\to\tlrr$ given by $f_*\mu(U)\coloneqq\mu(f\inv(U))$. If $\mu$ is continuous (resp.\ a probability valuation) then $f_*\mu$ is too.
\end{proposition}
\begin{proof}
The pullback functor $f\inv\colon\pow(Y)\to\pow(X)$ preserves limits and colimits, so any of the conditions 1,3,4,5 that holds for $\mu$ holds for $f_*\mu$ also. For 2, suppose $U\imp V$. Then $f\inv(U)\imp f\inv(V)$, so $\mu(f\inv(U))\leq\mu(f\inv(V))$, proving the result.
\end{proof}

\begin{theorem}
Probability valuations coincide with probability measures in XYZ cases....
\end{theorem}

Internalize the definition.

\begin{example}
A valuation on the one-point topological space is a map $\prop\to\trr$....
\end{example}

% ======== Chapter ========%
\chapter{Basic theory of internal valuations}

Let $\tii$ be the unit interval as in \cref{def.unit_interval}, and recall the inclusion $\inc : \prop \to \tii$, given by the constant function $\ind{P}(q)\coloneqq P$. When we discuss the modularity condition, we will implicitly use $\cast\colon\tii\to\tlrr$, sending $r\mapsto (q<0)\vee ((q<1)\wedge (q<r))$ as discussed in \cref{sec.valuations}. Recall also from \cref{cor.top_on_one} that $\prop$ is the unique topology on the one-point space $\{*\}$.

\begin{proposition}
	\label{prop.existence_val_on_1}
	There exists a valuation on the one-point space $\{*\}$, namely the indicator function $\inc : \prop \to \tii$.
\end{proposition}

\tob{Comment on the way in how the internal reasoning looks absurd at first look?}

\begin{proof}
	We first show that $\inc$ is indeed valuation. The normalization conditions and monotonicity follow directly from \cref{lemma.ind_monotonic}. 	Concerning modularity, for $P,Q : \prop$ we prove both inequality directions of the claimed equation
	\[
		\ind{P \lor Q} + \ind{P \land Q} = \ind P + \ind Q.
	\]
	First suppose $q < \ind{P \lor Q} + \ind{P \land Q}$. Thus there are $q_\lor$ and $q_\land$ such that $q = q_\lor + q_\land$ and
	\[
		q_\lor < \ind{P \lor Q}, \qquad q_\land < \ind{P \land Q}.
	\]
	There are three cases. (1) If $q_\vee<0$ and $q_\wedge<0$ then $q=q_\vee+q_\wedge<0<\ind P + \ind Q$. (2) If  $(q_\vee<1)\wedge(P\vee Q)$ and $q_\wedge<0$, then we have two similar subcases, either $P$ or $Q$. Assuming $P$ we have $q_\vee<\ind P$ and $q_\wedge<\ind Q$, so $q<\ind P+\ind Q$. (3) If $(q_\wedge<1)\wedge(P\wedge Q)$, then both $P$ and $Q$ (and also $q_\vee<1$), so $q_\vee<\ind P$ and $q_\wedge<\ind Q$, and thus $q<\ind P + \ind Q$.
	
	For the other direction, assume $q < \ind{P} + \ind{Q}$. This means that we have $q_P$ and $q_Q$ with $q = q_P + q_Q$ as well as $q_P < \ind{P}$ and $q_Q < \ind{Q}$. Again we have cases. (1) If $q_P<0$ and $q_Q<0$ then $q=q_P + q_Q<0<\ind{P \lor Q} + \ind{P \land Q}$. (2) If $q_P<0$ and $(q_Q<1)\wedge Q$ then $q_Q<\ind{P\vee Q}$ and $q_P<\ind{P\wedge Q}$; similarly if $q_Q<0$ and $(q_P<1)\wedge P$. (3) If $(q_P<1)\wedge P$ and $(q_Q<1)\wedge Q$ then $q_P<\ind{P\vee Q}$ and $q_Q<\ind{P\wedge Q}$.
	
	

	Concerning Scott continuity \eqref{eqn.scott_continuity}, for any subtype $D \ss \prop$, directed or otherwise, both sides of the desired continuity equation
	\[
		\sup_{P : D} \ind{P} = \ind{\exists (P:D) P},
	\]
	are identical; both sides are the constant predicate $\exists(P:D).P$ (see \cref{def.sup_unit_interval,prop.inc_const,prop.cast_sups}). Thus $\inc : \prop \to \tii$ is indeed a valuation.
\end{proof}

\begin{proposition}\label{prop.uniqueness_val_on_1}
	There is precisely one valuation on $\{*\}$, namely the indicator function $\inc : \prop \to \tii$.
\end{proposition}
\begin{proof}
By \cref{prop.existence_val_on_1} it suffices to show that an arbitrary valuation $\mu : \prop \to \tii$ on $\{*\}$ satisfies $\mu(P) = \ind{P}$ for all $P : \prop$. One direction is easy, namely
	\begin{equation}\label{eqn.ind_less_val}
		\ind{P} \le \mu(P).
	\end{equation}
	for all $P:\prop$. Indeed if $q<\ind{P}$ for some $0\leq q<1$ then $P$, in which case $\mu(P)=\mu(\top)=1$. 
	
	The other inequality requires more work. For $P:\prop$, consider the predicate
	\[
		d_P(Q) := \left( \mu(Q) = \ind{Q} \right) \land (Q \Rightarrow P).
	\]
	We claim that $D_P\coloneqq\{Q:\prop\mid d_P(Q)\}$ defines a directed subtype of $\prop$. Since $d_P(\bot)$ holds we have $\exists(Q:D_P).\top$. Now suppose that $d_P(Q_1)$ and $d_P(Q_2)$ for $Q_1, Q_2 : \prop$; we then claim that also $d_P(Q_1 \lor Q_2)$. Since $Q_1 \Rightarrow P$ and $Q_2 \Rightarrow P$, the part $(Q_1 \lor Q_2) \Rightarrow P$ is clear, so we need to show that also $\mu(Q_1 \lor Q_2) = \ind{Q_1 \lor Q_2}$. Using \eqref{eqn.ind_less_val} and the assumed modularity equation, we have
	\begin{align*}
		\ind{Q_1 \lor Q_2} + \ind{Q_1 \land Q_2}	& \le \mu(Q_1 \lor Q_2) + \mu(Q_1 \land Q_2)	\\
								& = \mu(Q_1) + \mu(Q_2) \\
								& = \ind{Q_1} + \ind{Q_2},
	\end{align*}
	where the last step uses the assumptions $d_P(Q_1)$ and $d_P(Q_2)$. But since $\inc$ is a valuation by \cref{prop.existence_val_on_1}, the left-hand side and the right-hand side of this chain of inequalities are equal, so $\ind{Q_1 \lor Q_2} = \mu(Q_1 \lor Q_2)$ by \cref{cor.favorite}. We have now proved our claim that $d_P(Q_1 \lor Q_2)$, making $D_P$ directed.

	A straightforward logical argument shows that
	\begin{equation}
		\label{PfromDQ}
		\exists (Q : D_P). Q \qquad \Longleftrightarrow \qquad P,
	\end{equation}
	where the implication from left to right combines the assumptions $Q$ and $Q \Rightarrow P$ to $P$, while the implication from right to left becomes trivial with $Q := \top$. Since $\mu$ is Scott continuous \eqref{eqn.scott_continuity}, we have
	\[
		\mu(P) = \mu\big( \exists (Q : D_P) . Q \big) = \sup_{Q : D_P} \mu(Q).
	\]
	But now since $d_P(Q)$ implies $\mu(Q) = \ind{Q}$ by definition, we have by the Scott continuity of the valuation $\inc$ that
	\[
		\sup_{Q : D_P} \mu(Q) = \sup_{Q : D_P} \ind{Q} = \ind{\exists(Q:D_P).Q}.
	\]
Now we can conclude using \eqref{PfromDQ} that $\mu(P)=\ind{P}$ as desired.
\end{proof}

Recall from \Cref{props_open} that for every $P : \prop$, the associated constant predicate $\_ \mapsto P$ is open in any topological space $(X,\Op_X)$. 

\begin{corollary}\label{cor.val_const_indicator}
	Let $(X,\Op_X)$ be a topological space and $\mu : \Op_X \to [0,1]$ any valuation. Then $\mu(\,\_\mapsto P) = \ind{P}$ for all $P : \prop$.
\end{corollary}

\begin{proof}
	By \cref{cor.top_on_one,prop.pushforward,prop.uniqueness_val_on_1}, we can take the pushforward of $\mu$ along the unique continuous map $!\colon X\to (*,\prop)$ and find $\mu(\_\mapsto P)=!_*\mu(P)=\ind{P}$.
\end{proof}

From now on we abuse notation, simply writing $P$ to denote the predicate $(\_\mapsto P)\colon X\to\prop$ on any type $X$.

% ======== Chapter ========%
\chapter{Interaction of valuations and modalities}


Recall modalities and decidable modalities from \cref{def.modality,def.decidable_modality}. 
\begin{theorem}
	\label{vals_vs_modalities}
	Let $j$ be a decidable modality and $\mu$ a valuation on an internal space $(X,\Op_X)$. Then for all $P : \Op_X$,
	\[
		\mu(jP) = j \mu(P).	
	\]
\end{theorem}

Note that if $P$ is open then so is $jP$ by \Cref{props_open}, which is necessary in order for $\mu$ to be applicable to $jP$ above.

\begin{proof}
	We first prove two auxiliary statements, both of which are special cases of the overall result.
	\begin{itemize}
		\item If $Q$ is any $j$-closed open, then $\mu(Q):\tii$ is $j$-closed.
			
			To begin the proof, we have the equivalences
			\begin{align*}
				Q \land (Q \Rightarrow j\bot) \quad & \Longleftrightarrow \quad j\bot, \\
				Q \lor (Q \Rightarrow j\bot) \quad & \Longleftrightarrow \quad \top,
			\end{align*}
			where the second one is an instance of the decidability assumption on $j$. Hence applying the modularity law to $Q$ and $Q \Rightarrow j\bot$ results in the equation
			\begin{align}
				\label{j_modularity}
				\begin{split}
					\mu(Q) + \mu(Q \Rightarrow j\bot)	& = \mu(j\bot) + \mu(\top) \\
										& = \ind{j \bot} + 1,
				\end{split}
			\end{align}
			where the second equality is by \cref{cor.val_const_indicator}.
			By \cref{cor.closed_sum},\dis{Need $j$ to commute with $\exists (q:\tqq)$ for this ($j$ decidable is not enough).} a sum of lower reals is $j$-closed if and only if each summand is. Since $j\bot$ and $\top$ are $j$-closed, the associated constant predicates $\ind{j\bot}$ and $1=\ind{\top}$ are too, and hence the right-hand side of \eqref{j_modularity} is $j$-closed. Hence the left-hand side is too, and it follows that $\mu(Q) = j \mu(Q)$, as was to be shown.
		\item If $R$ is any open with $jR$, then $j\mu(R) = j1$.

			The proof is simple: since $R$ implies $\mu(R) = 1$, clearly also $jR$ implies $j(\mu(R) = 1)$. But then also $j\mu(R) = j1$.
	\end{itemize}

	Getting to the proof of the main claim, we apply the modularity law to a very similar pair of opens as in the first item, namely $P$ and $P \Rightarrow j\bot$ (where the difference is that $P$ need not be $j$-closed). This gives
	\[
		\mu(P) + \mu(P \Rightarrow j\bot) = \mu(P \land (P \Rightarrow j\bot)) + \mu(P \lor (P \Rightarrow j\bot)).
	\]
	We now evaluate the second to fourth expressions in this equation with $j$ applied. The argument of the second is already $j$-closed, and therefore $\mu(P \Rightarrow j\bot)$ is also $j$-closed as per the first item above. For the third expression, we consider
	\[
		j \mu(\bot) \le j \mu(P \land (P \Rightarrow j\bot)) \le j \mu(j\bot).
	\]
	By \cref{lemma.j_indicator,cor.val_const_indicator} we have $j \ind{\bot}=j \mu(\bot)=j\mu(j\bot)$ and thus $j \mu(P \land (P \Rightarrow j\bot)) =  j \ind{\bot}$. Finally, we have $j \mu(P \lor (P \Rightarrow j\bot)) = j 1$ by the second item above, since $j$ is decidable; indeed, we have $jP\vee(P\imp j\bot)$ and $j(P \lor (P \Rightarrow j\bot))$ clearly holds in either case. Overall, we therefore get
	\[
		j \mu(P) + \mu(P \Rightarrow j\bot) = j \ind{\bot} + j 1.
	\]
	Since $P \Rightarrow j\bot$ is equivalent to $jP \Rightarrow j\bot$ and the right-hand side is independent of $j$, applying this equation with $jP$ in place of $P$ and cancelling $\mu(P \Rightarrow j\bot)$ results in $j \mu(P) = j \mu(jP)$. But since also $j \mu(jP) = \mu(jP)$ by the first item above, we therefore obtain the overall $\mu(jP) = j \mu(P)$.
\end{proof}


% ======== Chapter ========%
\chapter{Axioms and soundness proofs}

In this section, we introduce a collection of modalities which internally express the idea that our topos has enough points. We fix a type $\Pts$ and a function $\At[]\colon\Pts\to\decmod$, where $\decmod$ is the type of decidable modalities; see \cref{def.decidable_modality}. 

Our primary intended semantics is that our topos is $\shv(T)$ for some topological space $T$, and that every modality $\At{k}$ is the quasi-closed modality associated to the open set $T \setminus \overline{k}$. More precisely, consider the underlying set $T$ of the space, and consider the associated constant presheaf on $(T,\Op_T)$, which assigns the set $T$ to each open $U\in\Op_T$. We take $\church{\Pts}$ to be the sheafification of this presheaf. Our next goal is to define a sheaf homomorphism
\begin{equation}\label{eqn.at_semantics}
	\church{\At[]}\colon\church{\Pts}\to\church{\decmod}.
\end{equation}
Since sheafification is left adjoint to the underlying presheaf functor, and since the inclusion of constant presheaves is left adjoint to the global sections functor, the sheaf morphism $\At[]$ can be identified with a single function $j\colon T\to\church{\decmod}(T)$. So fix a point $t\in T$; to define an element $j_t\in\church{\decmod}(T)$ is to give a sheaf morphism $j_t\colon\Op_T\to\Op_T$ satisfying the following properties for all $U,V\in\Op_T$:
\begin{enumerate}
	\item $U\ss j_t(U)$;
	\item $j_t j_t(U)=j_t(U)$;
	\item $j_t(U\cap V)=j_t(U)\cap j_t(V)$; and
	\item $j_t(U)\cup (U^c\cup j_t(\varnothing))^\circ=T$.
\end{enumerate}
where $^c$ is complement and $^\circ$ is interior. We define $j_t\colon\Op_T\to\Op_T$ by
\begin{equation}\label{eqn.j_t}
	j_t(U)\coloneqq
	\begin{cases}
		(\{t\}^c)^\circ&\tn{ if }t\not\in U\\
		T&\tn{ if } t\in U
	\end{cases}
\end{equation}
If $t\in U$ then $j_t(U)=T$ and conditions 1, 2, and 4 are trivially satisfied. Supposing now that $t\not\in U$ then $U\ss \{t\}^c$ and hence $U\ss j_t(U)$, giving condition 1. Since $t\not\in(\{t\}^c)^\circ=j_t(U)$, we also have condition 2. Since $U\ss j_t(\varnothing)$, we have $T=U^c\cup U\ss (U^c\cup j_t(\varnothing))$ so we also have condition 4. For condition 3, if $t\in U\cap V$ then both sides are $T$; if $t\not\in U\cap V$ then $t\not\in U$ or $t\not\in V$ in which case both sides are $(\{t\}^c)^\circ$. Thus \eqref{eqn.j_t} satisfies the necessary conditions, and we have defined our sheaf homomorphism $\church{\At[]}$ from \eqref{eqn.at_semantics}.

\medskip

Similar to how a point of a locale is a completely prime filter on its frame of opens, we think of every $\At $ as specifying a point (although there is nothing in our axiomatics which requires the associated subtopos to be equivalent to $\Cat{Set}$). 

\begin{axiom}
	\label{ax:N_flabby}
	For all $\pt : \Pts$ and predicates $P : \tnn \to \prop$,
	\[
		\At \exists n : \tnn . P(n) \quad \Longrightarrow \quad \exists n : \tnn . \At P(n).
	\]
\end{axiom}

\tob{add soundness proof, or derive this from another axiom (it is arguably not provable from the other axioms, but we don't have the relevant counterexample either)}

Since $\tnn$ and $\tqq$ are internally bijective, it follows that the commutation of $\At[]$ and $\exists$ holds likewise for predicates on $\qq$.

% ======== Chapter ========%
\chapter{Main theorem}

We now want to consider the relation between valuations and an internal space and families $\At[]$-locally defined valuations.

We start by considering an analogous question for lower reals. For any $r : \tlrr$ and any $\pt : \Pts$, we get the $\At$-lower real $r_\pt := \At r$. Thus overall we have the family $(r_\pt)_{\pt \in \Pts}$. We now show which families arise in this way, and at the same time how a lower real can be pieced together from a family of $\At[]$-lower reals.

\begin{definition}
	A family $(r_\pt)_{\pt : \Pts}$ with $r_\pt \in \At \tlrr$ for every $\pt$ is \emph{lower semicontinuous} if for all $q : \tqq$ there is $U : \prop$ such that for all $\pt : \Pts$,
	\[
		r_\pt(q) \Leftrightarrow \At U.
	\]
\end{definition}

A lower semicontinuous family automatically satisfies the following monotonicity condition: for all $\pt,\pt' : \Pts$, we have
\begin{equation}
	\label{r_pt_monotone}
	r_\pt \le \At r_{\pt'},
\end{equation}
since similarly $\At U \imp \At \At{\pt'} U$.

\begin{proposition}[{$\At[]$-Locality of lower reals}]
	\label{prop:LR_locality}
	The map $r \mapsto (r_k)$ establishes a bijection between $\tlrr$ and families of $\At[]$-lower reals $(r_\pt)_{\pt \in \Pts}$ which are lower semicontinuous.
\end{proposition}

\begin{proof}
	We first show that for every $r : \tlrr$, the resulting family $(\At r)_{\pt \in \Pts}$ satisfies lower semicontinuity. For given $q : \tqq$ we take $U := r(q)$. Then since $r_\pt = \At r$, the equivalences
	\[
		r_\pt(q) \Leftrightarrow \At r(q) \Leftrightarrow \At U
	\]
	holds by definition.

	We next construct a map from lower semicontinuous families $(r_\pt)$ back to lower reals by putting
	\begin{equation}
		\label{lr_from_family}
		r(q) := \forall \pt : \Pts . r_\pt(q).
	\end{equation}
	We first show that $\At r = r_\pt$ for every $\pt$, or equivalently
	\[
		\At \forall \pt' . r_{\pt'}(q) \quad \Longleftrightarrow \quad r_\pt(q)
	\]
	for every $q$. Then consider $U$ as in the definition of lower semicontinuity, which reduces the problem to proving that
	\[
		\At \forall \pt' . \At[\pt'] U \quad \Longleftrightarrow \quad \At U,
	\]
	which is now obvious since $\forall \pt' . \At[\pt'] U$ is equivalent to $U$.

	We still need to show that \eqref{lr_from_family} indeed defines a nonnegative lower real. $r(q)$ for $q < 0$ clearly follows from the enough points condition and $r_k(q)$. Downward closure is also obvious, since the downward closure property of an $\At[]$-lower real is exactly the usual one which then transfers to $r$. Thus it remains to prove roundedness, which by the enough points property amounts to showing that if $r(q)$, then 
	\[
		\At \exists q' > q . r(q)
	\]
	for any $\pt : \Pts$. But then by \Cref{ax:N_flabby}, this is equivalent to $\exists q' > q. \At r(q)$, and the claim now follows by $\At r(q) = r_\pt(q)$.

	Finally, we prove that the above two constructions are inverses. Starting with $r \in \tlrr$, we need to prove that
	\[
		r(q) = \forall \pt : \Pts . \At r(q),
	\]
	which is an instance of the enough points condition. Starting with a lower semicontinuous family $(r_\pt)$, the relevant property is the equation
	\[
		r_\pt(q) = \At \forall \pt' : \Pts . \At[\pt'] r_{\pt'}(q)
	\]
	proven above.
\end{proof}

% ======== Chapter ========%

Recall that an \emph{$\At$-valuation} on an internal space $(X,\Op_X)$ is defined to be a map $\At \Op_X \to \At \tlrr$ satisfying the $\At$-local versions of the conditions in the definition of valuation. We now consider families of valuations $(\mu_\pt)_{\pt : \Pts}$.

\begin{definition}
	A family of valuations $(\mu_\pt)_{\pt : \Pts}$ is \emph{compatible} if for all $\pt, \pt' : \Pts$ and $P : \At \Op_X$,
	\[
		\mu_{\pt'}(\At[\pt'] P) = \At[\pt'] \mu_\pt(P).
	\]
\end{definition}

In order to understand this condition, let us consider the cases $\At \At[\pt'] \bot$ and $\At \bot \imp \At[\pt'] \bot$ separately. 

\chapter{Open questions}


\appendix

% ======== Chapter ========%
\chapter{Topos theoretic background}\label{sec.topos_background}
%% ==== Section ====%
%\section{Spaces of compacts}
%
%We often denote a topological space $(X,\Op_X)$ by its set of points $X$, leaving $\Op_X$ implicit.
%
%For any topological space $X$, consider the set $\cpct{X}$ whose elements are the nonempty compact subsets $K\ss X$; as a point we denote it $\pt{K}\in\cpct{X}$. We can endow $\cpct{X}$ with the \emph{upper space} topology, which has the following basis. For every $U\ss X$ open, let $\bas{U}=\{\pt{K}\in\cpct{X}\mid K\ss U\}$.
%
%\begin{example}
%Let $T$ be a set endowed with a discrete topology. Then a subset is compact iff it is finite. If $t\neq t'$ are distinct elements of $T$ then $\bas{\{t\}}$, $\bas{\{t'\}}$, and $\bas{\{t,t'\}}$ are all open, and the inequality $\bas{\{t\}}\cup\bas{\{t'\}}\subset\bas{\{t,t'\}}$ is strict, containing two and three points respectively.
%\end{example}
%
% ==== Section ====%
\section{Sheaves on a topological space}

For any topological space $(X,\Op_X)$, we consider $\Op_X$ as a category whose objects are open subsets $U\in\Op_X$ and for which there is a unique morphism $i_{V,U}\colon V\to U$ whenever $V\ss U$. We denote $i_{V,X}$ simply by $i_V$.

\begin{definition}[Sheaf]\label{def.sheaf}
Let $(X,\Op_X)$ be a topological space. A \emph{presheaf} on $X$ is a functor $\sheaf{F}\colon\Op_X\op\to\smset$. For each open $U\in\Op_X$ we refer to $\sheaf{F}(U)$ as the set of \emph{$\sheaf{F}$-sections on $U$}. Given an open subset $i_{V,U}\colon V\ss U$, we denote the function $\sheaf{F}(i_{V,U})$ by $\rest{-}{V}\colon\sheaf{F}(U)\to\sheaf{F}(V)$; for any $f\in\sheaf{F}(U)$, we refer to $\rest{f}{V}$ as the \emph{restriction of $f$ to $V$}.

Given a set $I$, collection of open sets $U\colon I\to\Op_X$, and family of sections $f_i\in\sheaf{F}(U_i)$, one for each $i\in I$, we say that $(f_i)_{i\in I}$ is a \emph{compatible family} if for every $i,j\in I$ we have $\rest{f_i}{U_i\cap U_j}=\rest{f_j}{U_i\cap U_j}$. We say that $\sheaf{F}$ satisfies the \emph{sheaf condition} for the compatible family $(f_i)_{i\in I}$ if there exists a unique $f\in \sheaf{F}(\bigcup_{i\in I}U_i)$ such that $\rest{f}{U_i}=f_i$ for each $i\in I$. We say that $\sheaf{F}$ is a \emph{sheaf} if it satisfies the sheaf condition for every set $I$, $U$, and $(f_i)_{i\in I}$.

A \emph{morphism $\sheaf{F}\to\sheaf{G}$ of presheaves (resp.\ sheaves) on $X$} is defined simply as a natural transformation between the functors. Denote by $\shv(X)$ the category of sheaves and their morphisms.
\end{definition}

\begin{remark}[Unique section on $\varnothing$]\label{rem.unique_sec_empty}
When $I=\varnothing$ is empty then the unique $I$-indexed family of sections is compatible, so $\cat{F}\colon\Op_X\op\to\smset$ satisfies the sheaf condition for this family iff $\sheaf{F}(\varnothing)\cong 1$ is a singleton set.
\end{remark}

\begin{remark}[Defining a sheaf on basic opens]
If $(U_b)_{b\in B}$ is a basis for the topology on $X$, then a sheaf $\sheaf{F}$ on $X$ determines a set $\sheaf{F}(U_b)$ for each $U_b$, a function $\sheaf{F}(U_b)\to\sheaf{F}_{U_{b'}}$ for $U_b'\ss U_b$, and a sheaf condition for every compatible family of basic opens whose union is again a basic open. 

Conversely, suppose we define $\sheaf{G}$ only on basic opens: give a set $\sheaf{G}(U_b)$ for each basic $U_b$ and a restriction map $\sheaf{G}(U_b)\to\sheaf{G}(U_{b'})$ whenever $U_{b'}\ss U_b$. Suppose further that for every covering $U=\bigcup_{i\in I}U_i$, with $U$ and each $U_i$ basic, and for each family $g_i\in\sheaf{G}(U_i)$ that are compatible (in the sense that on all basic opens $U'\ss U_i\cap U_j$ we have $\rest{g_i}{U'}=\rest{g_j}{U'}$), there exists a unique $g\in \sheaf{G}(U)$ with $\rest{g}{U_i}=g_i$. Then $\sheaf{G}$ extends uniquely to a sheaf on the whole space $X$.
\end{remark}

\begin{example}[$\smset$ as a topos]\label{ex.set_topos}
Let $\{*\}$ be the unique one-point topological space. It has two open sets $\varnothing\ss\{*\}$, so a presheaf $\sheaf{F}$ on $\{*\}$ consists of a function $\sheaf{F}(\{*\})\to\sheaf{F}(\varnothing)$. By \cref{rem.unique_sec_empty}, if $\sheaf{F}$ is to be a sheaf then $\sheaf{F}(\varnothing)\cong 1$. It follows that sheaves on a point are simply sets,
\[
\shv(\{*\})\cong\smset.
\]
Thus $\smset$ is an example of a topos, in some sense the primordial one.
\end{example}

\begin{example}[Representables]\label{ex.representable_sheaf}
Let $X$ be a space. For every open $U\in\Op_X$, there is a sheaf $y_U\in\shv(X)$ called the \emph{representable on $U$}; it is given by $y_U=\Op_X(-,U)$, or more explicitly
\[
	y_U(V)=
	\begin{cases}
	\{*\}&\tn{ if }V\ss U\\
	\varnothing&\tn{ if }V\not\ss U
	\end{cases}
\]
For any sheaf $\sheaf{F}$, the product $\sheaf{F}_U\coloneqq y_U\times\sheaf{F}$ is isomorphic to $\sheaf{F}$ on opens $V\ss U$ and empty otherwise; we call it the \emph{restriction of $\sheaf{F}$ to $U$}. Thus by \cref{def.sheaf} we can restrict both sheaves and sections of sheaves to open subsets.
\end{example}

\begin{example}[Sheaf of opens, $\Omega$]\label{ex.subobject_classifier}
Let $X$ be a space. For every open $U\in\Op_X$, let $\Omega(U)\coloneqq\{V\in\Op_X\mid V\ss U\}$. This defines a presheaf, where for any $U'\ss U$ and $V\ss U$ we define the restriction of $V$ to $U'$ by $\rest{V}{U'}\coloneqq V\cap U'$. It is a sheaf because for any $(U_i)_{i\in I}$ and choices of $V_i\ss U_i$, the element $\bigcup_iV_i\in\Omega(\bigcup_i U_i)$ is the unique element that restricts on each $U_i$ to the chosen section $V_i$.

Note that in $\smset=\shv(\{*\})$ the above description reduces to $\Omega(*)=\{V\ss\{*\}\}\cong\{\varnothing,\{*\}\}$. This two-element set can be fruitfully identified with the booleans $\{\true,\false\}$ as we will see in \cref{sec.logic}.
\end{example}

\begin{example}\label{ex.sections}
Let $F\colon Y\to X$ be a morphism of topological spaces. The \emph{sheaf of local $F$-sections}, denoted $\sec_F$, is the sheaf defined on an open set $U\ss X$ as
\begin{equation}\label{eqn.sections}
\sec_F(U)\coloneqq\{f\colon U\to Y\mid F\circ f=i_U\}
\qquad
\begin{tikzcd}
	&Y\ar[d, "F"]\\
	U\ar[r, hook, "i_U"']\ar[ur, dashed, "f"]&
	X
\end{tikzcd}
\end{equation}
with the restriction map for $V\ss U$ given by $\rest{f}{V}\coloneqq f\circ i_{V,U}$. It is a sheaf because, abstractly speaking, the union of open subsets is their colimit as topological spaces; or more concretely because any compatible family $(f_i\colon U_i\to Y)$ of local sections defines a unique function $f\colon \cup_iU_i\to Y$ on points, and one can check that $f$ is continuous.

In particular, given a space $R$, we can apply the above construction to the projection $\pi\colon R\times X\to X$. In this case $\sec_\pi$ sends $U\ss X$ to the set of all continuous maps $U\to R$. We denote this sheaf in typewriter font $\internal{R}$.

We will have occasion to consider this construction in the case when $R=\rr$ is the usual topological space of real numbers; we call $\trr$ the \emph{sheaf of Dedekind real numbers on $X$}. We will also consider this construction for $R=\nn$; we call $\tnn$ the \emph{sheaf of natural numbers on $X$}. If $U$ is an open with $k$ connected components, we have $\tnn(U)\cong\nn^k$.
\end{example}

\begin{definition}[Stalk]
Let $\sheaf{F}$ be a sheaf on $X$ and $x\in X$ a point. The \emph{stalk of $\sheaf{F}$ at $x$}, denoted $\sheaf{F}_x$ is given by the colimit
\[\sheaf{F}_x\coloneqq\colim_{x\in U\in\Op_X}\sheaf{F}(U).\]
That is, $\sheaf{F}_x$ is the set $\{(U,f)\mid U\in\Op_X, x\in U, f\in \sheaf{F}(U)\}/\sim$ where we put $(U,f)\sim (U',f')$ iff $\rest{f}{U\cap U'}=\rest{f'}{U\cap U'}$. Write $[U,f]\in \sheaf{F}_x$ to denote the equivalence class represented by $(U,f)$.
\end{definition}

The following is well-known, but we recall it here to fix ideas and notation.

\begin{proposition}\label{prop.local_homeo}
For every sheaf $\sheaf{F}$ on $X$, there exists a topological space $E_\sheaf{F}$ and a local homeomorphism $\pi\colon E_\sheaf{F}\to X$ such that $\sec_\pi\cong\sheaf{F}$. This construction gives an equivalence of categories between $\shv(X)$ and the local homeomorphisms over $X$.
\end{proposition}
\begin{proof}
Consider the set $E_\sheaf{F}\coloneqq\bigsqcup_{x\in X}\sheaf{F}_x$ given by the disjoint union of all stalks of $\sheaf{F}$; it comes with an obvious function $\pi\colon E_\sheaf{F}\to X$ sending $(x,[U,f])\mapsto x$. We define a topology on $E_\sheaf{F}$ by giving a basis; namely for every open $U\ss X$ and element $f\in\sheaf{F}(U)$, the set $(U,f)\coloneqq\{(x,[U,f])\mid x\in U\}$ is a basic open. Now we see that $\pi$ is a local homeomorphism because for any $x$, the image of a basic open is $\pi(U,f)=U$ and one can check that the bijection $(U,f)\to U$ sending $(x,[U,f])\mapsto x$, and its inverse, are both continuous.

Given an open $U$ and a section $f\in\sheaf{F}(U)$, we obtain a local section $U\to E_\sheaf{F}$ of $\pi$ by sending $x\mapsto (x,[U,f])$. Going the other way, an arbitrary local section $g\colon U\to E_\sheaf{F}$ assigns to each $x\in U$ some $(x,[V_x,g_x])\in E_\sheaf{F}$. Fix $u\in U$. We may assume $(V_u,g_u)$ is a basic open without changing the section $g$. Because \eqref{eqn.sections} commutes and $\pi$ is a local homeomorphism, $g\inv(V_u,g_u)=U\cap V_u$, which implies that for all $x\in U\cap V_u$ we have $g_{x}=g_u$ on $V_x\cap V_u$. Thus we may assume $V_x=V_u$ and $g_x=g_u$ for all $x\in V_u$. Repeating this for all $u$, we obtain a cover $\{V_u\}_{u\in U}$ of $U$ and a compatible family of sections $g_u$, which we can glue to obtain the desired section of $\sheaf{F}(U)$.

We leave the proof of the equivalence of categories to the reader, or see \cite[Corollary 2.6.3]{MacLane.Moerdijk:1992a}.
\end{proof}

Together, the space $E_\sheaf{F}$ and local homeomorphism $\pi\colon E_\sheaf{F}\to X$ are called the \emph{\'etal\'e space associated to $\sheaf{F}$}. Note that one can compute stalks of $\sheaf{F}$ using only basic opens, and also compute $E_\sheaf{F}$ using only basic opens throughout the definition.

\begin{theorem}\label{thm.sheafify}
For any space $X$, the inclusion $i\colon\shv(X)\to\psh(X)$ has a left adjoint
\[
\adj{\psh(X)}{\fun{sh}}{i}{\shv(X)}
\]
and $\fun{sh}$ preserves finite limits.
\end{theorem}
We will not give a proof here, but we will give the construction. To every presheaf $\sheaf{F}$, define its \emph{sheafification} $\fun{sh}(\sheaf{F})$ by
\[
	\fun{sh}(\sheaf{F})(U)
	\coloneqq
	\left\{(f_u)\in\prod_{u\in U}\sheaf{F}_u\;\middle|\;
	\parbox{2.8in}{$\forall u\in U,\exists V\tn{ open}, u\in V\tn{ and }\\\exists f_V\in\sheaf{F}(V)
\tn{ such that } f_u=[V, f_V]\tn { in }\sheaf{F}_u.$}
\right\}.
\]


% ==== Section ====%
\section{The topos of sheaves on $X$}

The category of sheaves on $X$ has excellent formal properties, quite similar to those of the category $\smset$. In particular it forms a Grothendieck topos. 

\begin{definition}[Grothendieck topos]\label{def.Grothendieck_topos}
An \emph{Grothendieck topos} is a category $\cat{E}$ that 
\begin{enumerate}
	\item has all small limits and colimits;
	\item is Cartesian closed;
	\item has a subobject classifier $\top\colon 1\to\Omega$; and
	\item has a small generating set.
\end{enumerate}
\end{definition}
We assume the reader knows the definition of the first two, though we note that while limits are computed pointwise,
\[\Big(\lim_{i\in I}\sheaf{F_i}\Big)(U)=\lim_{i\in I}\big(\sheaf{F_i}(U)\big),\]
colimits are not: after taking the pointwise colimit, one must sheafify as in \cref{thm.sheafify}. We also note that the exponential $Y^X$ denotes the sheaf whose sections on $U\ss X$ is given by the set of sheaf homomorphisms $X_U\to Y_U$ between the restrictions of $X$ and $Y$ to $U$, as in \cref{ex.representable_sheaf}.

 What it means for $\top\colon 1\to \Omega$ to be a \emph{subobject classifier} is that for any monomorphism $i\colon A\inj B$, there exists a unique morphism $\classify{i}\colon B\to\Omega$ such that the following square is a pullback
\begin{equation}\label{eqn.subobject_classifier}
\begin{tikzcd}
	A\ar[r, "!"]\ar[d, "i"']&
	1\ar[d, "\top"]\\
	B\ar[r, "\classify{i}"']&
	\Omega\ar[ul, phantom, very near end, "\lrcorner"]
\end{tikzcd}
\end{equation}
Note that any category, a morphism out of a terminal object $1$ is a vacuously a monomorphism and the pullback of a monomorphism is a monomorphism. Thus we have a bijection: for every morphism $B\to \Omega$, the pullback of $\top$ is a monomorphism into $B$ and every monomorphism into $B$ arises in this way.

What it means that $\cat{E}$ has a generating set is that there exists a set $I$ and objects $(x_i)_{i\in I}$ that can distinguish between every parallel pair of morphisms. That is, for any objects $a,b$ and morphisms $g,g'\colon a\to b$ in $\cat{E}$, if $g\circ f=g'\circ f$ for all $i\in I$ and $f\colon x_i\to a$ then $g=g'$.

\begin{remark}
In this paper, we will only work with a special kind of Grothendieck topos, namely one of the form $\cat{E}\coloneqq\shv(X)$ for a chosen topological space $(X,\Op_X)$, which we refer to as the \emph{site} for the topos. In reality there may be many sites for the same topos, but we take $X$ as given.
\end{remark}

\begin{remark}
As one may guess, the subobject classifier for $\shv(X)$ is the sheaf $\Omega$ of opens from \cref{ex.subobject_classifier}. Given $i\colon A\inj B$, the sheaf morphism $\classify{i}\colon B\to\Omega$ is defined on $U\ss X$ by sending $b\in B(U)$ to the open set
\[
	\classify{i}(U)(b)\coloneqq
	\bigcup\left\{V\ss U\;\middle|\;\exists a\in A(V) \tn{ such that } i(a)=\rest{b}{V}\right\}.
\]
\end{remark}

\begin{definition}
In a category $\cat{E}$ with a terminal object $1$, a \emph{natural numbers object} is a tuple $(\tnn,z,s)$, where $\tnn\in\cat{E}$ is an object, $z\colon 1\to\tnn$ is a morphism called \emph{zero}, and a $s\colon \tnn\to \tnn$ is a morphism called \emph{successor}, that is universal in the sense that for any $(N',z',s')$, with $z'\colon 1\to N'$ and $s'\colon N'\to N'$, there exists a unique morphism $\mathrm{ind}_{z',s'}\colon N\to N'$ such that the following diagram commutes:
\[
\begin{tikzcd}
	1\ar[r, "z"]\ar[d, equal]&
	\tnn\ar[r, "s"]\ar[d, "\mathrm{ind}_{z',s'}"]&
	\tnn\ar[d, "\mathrm{ind}_{z',s'}"]\\
	1\ar[r, "z'"']&
	N'\ar[r, "s'"']&
	N'
\end{tikzcd}
\]
\end{definition}

Every Grothendieck topos has a natural numbers object given by the coproduct $\tnn\coloneqq\coprod_{n\in\nn}\{*\}$ with $z=(0,*)$ and $s(n,*)=(n+1,*)$. As a sheaf, $\tnn$ has the description from \cref{ex.sections}.


\section{Logic in a topos}\label{sec.logic}

In any topos, one can interpret the logical constants $\true,\false$, the logical operations $\wedge,\vee,\imp,\neg$, and the logical quantifiers $\forall,\exists$ in terms of the subobject classifier $\Omega$. In the topos $\smset$, we saw in \cref{ex.subobject_classifier} that $\Omega$ can be identified with the booleans, and we are accustomed to thinking of the logic in terms of operations on booleans. The point is that this can be generalized.

We can think of $\Omega$ as the sheaf of ``answers to yes/no questions''. Imagine the sphere $S$ as the surface of the earth; by \cref{ex.subobject_classifier}, sections of the sheaf $\Omega$ are open subsets of $S$. In the topos $\shv(S)$, when one asks ``is it raining'', we can answer it with the largest open set $U\ss S$ throughout which it is raining. On the topos of sheaves on a single point, open sets are either everything or empty, recovering the notion of ``yes/no.''

Fix a space $X$. The sheaf $\Omega\in\shv(X)$ is a \emph{poset object}, i.e.\ its sections on any $U\in\Op_X$ are endowed with a natural ordering. Indeed, we can identify any two sections $V,V'\in\Omega(U)$ with opens $V,V'\ss U$ and write
\begin{equation}\label{eqn.prop_order}
V\leq V'\tn{ iff }V\ss V'.
\end{equation} 
Clearly this order is reflexive, transitive, and antisymmetric. In the case $X=\{*\}$ this ordering is just $\false<\true$.

To interpret the logical constants, operations, and quantifiers in $\Omega$, or more specifically in the set $\Omega(U)$ for some open $U\ss X$, we need only think about their universal properties, and then define operations on open sets accordingly. For example $\true$ should be the maximal element, so we take $\true\in\Omega(U)$ to denote the open $U\ss U$; similarly $\false$ denotes the open $\varnothing\ss U$. For $V,V'\ss U$, the conjunction $V\wedge V'$ should be the maximal element under both $V$ and $V'$, so it denotes the open $V\cap V'$; similarly $V\vee V'$ denotes the open $V\cup V'$.

Implication and negation are only slightly more involved. Logically, we say that hypothesis $V$ is enough to prove $V_1\imp V_2$ when $V\wedge V_1$ is enough to prove $V_2$. Thus we define $V_1\imp V_2$ to be the open set
\begin{equation}\label{eqn.implication}
	(V_1\imp V_2)\coloneqq\bigcup\{V\ss U\mid (V\cap V_1)\ss V_2\}.
\end{equation}
 As a particular case, defining $\neg V\coloneqq (V\imp \false)$, we can identify $\neg V$ with the interior of the complement of $V$. For example, if $U=\rr$ and $V=\rr-\{0\}$, then $\neg V=\false$ and $\neg\neg V=\true$; in general there is an inequality $V\leq\neg\neg V$, which may be strict. Toposes for which $\neg\neg V=V$ are called \emph{boolean}, and correspond to topological spaces that are totally disconnected.

To define $\exists$ and $\forall$, we need to discuss predicates. For any sheaf $A$, a \emph{predicate on $A$} is a sheaf morphism $p\colon A\to\Omega$. The quantifiers $\forall(a:A)$ and $\exists(a:A)$ take a predicate in two variables, say $q\colon A\times B\to\Omega$ and return a predicate $B\to\Omega$ in one variable. Namely, define $\exists(a:A).q(a)$ to be the sheaf morphism $B\to\Omega$ that on any $U\in\Op_X$ assigns to a given $b\in B(U)$ the open set
\[
\big(\exists(a:A).q(a)\big)_U(b)\coloneqq\bigcup\left\{V\ss U\;\middle|\;\exists a\in A(V), q_V\big(a,\rest{b}{V}\big)=V\right\}\cong\bigcup_{V\ss U,a\in A(V)}q_V\big(a,\rest{b}{V}\big).
\]
The universal quantifier is the most involved. Define $\forall(a:A).q(a)$ to be the sheaf morphism $B\to\Omega$ that on any $U\in\Op_X$ assigns to a given $b\in B(U)$ the open set
\[
\big(\forall(a:A).q(a)\big)_U(b)\coloneqq\bigcup\left\{V\ss U\;\middle|\;
\forall V'\ss V \tn{ open, and } \forall a\in A(V'), q_{V'}\big(a,\rest{b}{V'}\big)=V'\right\}.
\]

With all these definitions, logical deductions can be carried out in the usual style, with the caveat that they must be constructive. It is an extra axiom to say $\neg\neg V=^?V$ or $\neg\forall (a:A).q(a) =^? \exists (a:A)\neg q(a)$; such ``tricks'' with negation do not hold unless the site happens to have a simplified form (e.g.\ if it happens to be totally disconnected).

We will give an example of this sort of deduction in \cref{ex.modality_deduction}.

% ==== Section ====%
\section{The internal language of $\shv(X)$}\label{sec.internal_language}

The analogy between any topos $\cat{E}$ and the category (topos) of sets is deep enough that one can write formulas for set-theoretic objects in the usual way, and interpret them as formulas for objects in $\cat{E}$ using a system called \emph{Kripke-Joyal semantics}. For example, if $A$ and $B$ are sets then 
\begin{equation}\label{eqn.epi}
\{f\colon A\to B\mid \forall (b:B).\exists(a:A). f(a)=b\}
\end{equation}
is the set-theoretic way of expressing the set of surjections $A\surj B$, i.e.\ epimorphisms in the category of sets. Using Kripke-Joyal semantics, this formula has a unique interpretation in an arbitrary topos $\cat{E}$ for arbitrary objects $A,B\in\cat{E}$. If $\cat{E}=\shv(X)$ for some space $X$ and $A,B$ are sheaves on $X$, then the above formula corresponds to the sheaf that assigns to $U\ss X$ the set of all epimorphisms of sheaves $A_U\to B_U$, where $A_U$ and $B_U$ are the restrictions of $A$ and $B$ to $U$ (see \cref{ex.representable_sheaf}).

Perhaps more convincing is the case of real numbers. Dedekind's definition of a real number was as a pair of subsets of $\qq$ satisfying certain properties: one is down-closed, the other is up-closed, they do not intersect, etc. These properties can all be written set-theoretically and interpreted in $\cat{E}=\shv(X)$ using Kripke-Joyal semantics. It turns out that the resulting sheaf $\trr$ is precisely the sheaf of Dedekind real numbers on $X$ from \cref{ex.sections}, i.e.\ $\trr(U)\cong\{f\colon U\to\rr\mid f\tn{ continuous}\}$. This is often considered strong evidence that the Kripke-Joyal semantics works sensibly.

We cannot give a complete description of the Kripke-Joyal semantics here; for that see \cite{MacLane.Moerdijk:1992a}. Instead, we give the basic idea and hope that readers can use it to follow along, reserving a complete understanding for when they have time to go deeper.

Set-theoretic formulas such as \eqref{eqn.epi}, written in set-builder or \emph{comprehension} notation $\{\cdots\mid\cdots\}$ consist of a left part and a right part. The left-hand part is a term of some type, where the type can be any set. For example $r:\rr$ or $(x,y): X\times Y$ or $f:Y\to Z$. In a more general topos $\cat{E}$, a type can be any object of $\cat{E}$. Toposes have products $(X\times Y)$ and exponentials $Z^Y$ (denoting the sheaf of local sheaf homomorphisms $Y\to Z$; see after \cref{def.Grothendieck_topos}), which can be used to construct more complex objects, allowing us to write the above terms $(x,y):X\times Y$ and $f:Y\to Z$ just as we did for sets. We refer readers to \cite[Section VI.5]{MacLane.Moerdijk:1992a} for details.

In the comprehension syntax $\{x:X\mid\varphi(x)\}$, the right-hand part is a logical formula $\varphi$ whose only free variable is $x$ (though $x$ itself may be constructed as a tuple of other variables). Note that $\varphi$ possibly could have additional \emph{bound} variables introduced by quantifiers. For example in \eqref{eqn.epi}, we have $\varphi=\forall (b:B).\exists(a:A). f(a)=b$, which has bound variables $b:B$ and $a:A$, and free variable $f$ introduced on the left-hand part. The formula $\varphi$ denotes a sheaf morphism $X\to\Omega$. Pulling back the monomorphism $\top\colon 1\to\Omega$, we obtain a subobject of $X$ in the top left, which is what the comprehension syntax actually means:
\[
\begin{tikzcd}
	\{x:X\mid\varphi(x)\}\ar[r, "!"]\ar[d, "i"']&
	1\ar[d, "\top"]\\
	X\ar[r, "\varphi"']&
	\Omega\ar[ul, phantom, very near end, "\lrcorner"]
\end{tikzcd}
\]

The Kripke-Joyal semantics invites us not to give the largest open set throughout which a proposition $\varphi$ is true, but instead to simply know whether it is true throughout a given open $U\in\Op_X$. The notation for this is $U\forces\varphi$ and pronounced \emph{$U$ forces $\varphi$}.%
\footnote{The terminology ``forcing'' comes from Cohen's proof of the independence of the continuum hypothesis.}
We use the notation $\prop$ rather than $\Omega$ in this context, because it is becoming standard. Similarly, we denote $\top\in\Omega$ by $\true:\prop$ and $\false\coloneqq\neg\true$. Recall the order $\leq$ on $\prop$ given in \eqref{eqn.prop_order}.

Here is a list of rules for $\forces$,%
\footnote{The list is not minimal: many of the rules shown follow from others. In fact rule 1 is complete! The other rules simply remind us of the semantics of the logical symbols.
}
where $I$ denotes any set, $U, U_i, V$ denote any opens, and $\varphi,\varphi_i,\psi$ denote any predicates:
\begin{enumerate}
	\item Suppose that the open set corresponding to $\varphi\in\prop$ is $U\in\Op_X$. Then $V\forces\varphi$ iff $V\ss U$.
  \item If $\varphi\leq\psi$ in $\prop$ and $U\forces\varphi$ then $U\forces\psi$.
  \item $U_i\forces\varphi$ for each $i\in I$ implies $\left(\bigcup_{i\in I}U_i\right)\forces\varphi$.
  \item $U\forces\true$ for every $U$.
  \item $U\forces\false$ iff $U=\varnothing$.
  \item $U\forces\varphi\wedge\psi$ iff $U\forces\varphi$ and $U\forces\psi$.
  \item $U\forces\varphi_1\vee\varphi_2$ iff there exist $U_1,U_2$ with $U=U_1\cup U_2$ and $U_1\forces\varphi_1$ and $U_2\forces\varphi_2$.
  \item $U\forces \varphi\imp\psi$ iff whenever $V\forces\varphi$ holds for $V\ss U$, then also $V\forces\psi$ holds.
  \item $U\forces\neg\varphi$ iff whenever $V\forces\varphi$ holds for $V\ss U$, then $V=\varnothing$.
  \item $U\forces\exists (a:A).\varphi(a)$ iff there exists $(U_i)_{i\in I}$ and $a_i\in A(U_i)$ for each $i\in I$, with $U=\bigcup_iU_i$ and $U_i\forces\varphi(a_i)$.
  \item $U\forces\forall (a:A).\varphi(a)$ iff for every $V\ss U$ and $a\in A(V)$ it holds that $V\forces \varphi(a)$.
\end{enumerate}
We say that $\varphi$ holds in the topos $\shv(X)$ when $X\forces\varphi$.


\begin{example}
Let $X=\{*\}$. We will show that the formula $\varphi\coloneqq\forall (p:\prop).p\vee\neg p$ holds using the Kripke-Joyal semantics, i.e.\ that $X\forces\varphi$. The proof goes as follows:

By rule 11, we need that for every $V\ss X$ and every $p:\prop(V)$ it holds that $V\forces p\vee\neg p$. But $V$ is either $\varnothing$ or $X$ and in the first case $V$ forces everything by rule 1, so we may assume $V=X$. By rule 7, it suffices to show that $X\forces p$ and $\varnothing\forces\neg p$ or that $X\forces\neg p$ and $\varnothing\forces p$. Again by rule 1 this reduces to showing either that $X\forces p$ or $X\forces\neg p$.

Now $p\in\prop$ corresponds to an open of which there are only two: namely $X$ and $\varnothing$. If it is $X$ then $X\forces p$ by rule 1. So we may assume $p$ corresponds to $\varnothing$, in which case only $\varnothing\forces p$ by rule 1 and we have $X\forces\neg p$ by rule 9, completing the proof.
\end{example}

In general, we write $A\imp B\imp C$ to mean $A\imp(B\imp C)$. Similarly, we write $P\to Q\to R$ to mean the type $(R^Q)^P$.

\begin{definition}[Internal poset]\label{def.internal_poset}
An \emph{internal poset} in $\cat{E}$ consists of
\begin{enumerate}
	\item an object $P\in\cat{E}$ and
	\item a morphism $(\leq)\colon P\to P\to\prop$
\end{enumerate}
satisfying the following conditions, written in the internal language:
\begin{enumerate}[label=\alph*.]
	\item $\forall (p:P).p\leq p$
	\item $\forall (p,q,r:P).(p\leq q)\imp (q\leq r)\imp(p\leq r)$.
	\item $\forall (p,q:P).(p\leq q)\imp(q\leq p)\imp (p=q).$
\end{enumerate}
\end{definition}

\begin{example}
We showed in \cref{eqn.prop_order} that $(\prop,\leq)$ is an internal poset.
\end{example}

% ==== Section ====%
\section{Modalities on $\shv(X)$}\label{sec.modalities}sec.logic

Modalities operate on propositions to give new propositions that hold more generally. More precisely, we have the following definition. 

\begin{definition}[Modality]\label{def.modality}
A \emph{modality} on a topos $\cat{E}$ is a morphism $j\colon\prop\to\prop$ satisfying the following three axioms for $p,q:\prop$:
\begin{enumerate}
	\item $p\imp j(p)$;
	\item $j(j(p))=j(p)$.
\end{enumerate}
These first two say that $j$ is a \emph{closure operator}. The following four axioms are equivalent, and to be a modality $j$ is required to satisfy any one---hence all---of them:
\begin{enumerate}[label=3\alph*.]
  \item $(p\imp q)\imp jp\imp jq$
  \item $jp\imp(p\imp jq)\imp jq$
  \item $j(p\imp q)\imp jp\imp jq$
  \item $(jp\wedge jq)\imp j(p\wedge q)$.
\end{enumerate}
\end{definition}
The equivalence of the conditions 3a -- 3d can be found in \cite[Lemma 4.6]{schultz2019temporal}.

It turns out that modalities on $\cat{E}$ correspond one-to-one with subtoposes of $\cat{E}$, though we do not need that here. We will discuss three sorts of modalities, called \emph{open, closed}, and \emph{quasi-closed}, associated to open sets $U\in\Op_X$, or equivalently to propositions $u:\prop$.

\tob{We probably only really need quasi-closed modalities. Or perhaps even only decidable ones: decidable is apparently equivalent to quasi-closed and prime, and this seems to be what we want}

\begin{definition}\label{def.open_closed_qc}
Let $u:\prop$ be a proposition. We have the following modalities:
\begin{description}
	\item[Open:] $O_u(p)\coloneqq u\imp p$;
	\item[Closed:] $C_u(p)\coloneqq u\vee p$; and
	\item[Quasi-closed:] $Q_u(p)\coloneqq (p\imp u)\imp u$.
\end{description}
\end{definition}

Above we promised to give examples of logical deductions. Now we will show that each of the purported modalities in \cref{def.open_closed_qc} is indeed a modality using logical deductions.

\begin{example}\label{ex.modality_deduction}
Let $u:\prop$; we want to show that $O_u$, $C_u$, and $Q_u$ from \cref{def.open_closed_qc} are modalities in the sense of \cref{def.modality}. We begin with $j=O_u$; let $p:\prop$ be a proposition. We begin by being quite pedantic and eventually move toward the style of deduction that we will use in the paper.

Claim: $p\imp (u\imp p)$. Proof: 1. To show $p\imp (u\imp p)$ it suffices to assume $p$ and prove $u\imp p$. 2. Assume $p$. 3. To prove $u\imp p$ it suffices to assume $u$ and prove $p$. 4. Assume $u$. 5. $p$ holds by line 2, completing the proof.

Claim: $(u\imp(u\imp p))\imp (u\imp p)$. Proof: Assume $u\imp (u\imp p)$; we wish to prove $u\imp p$. Assume $u$; we wish to prove $p$. Since $u\imp (u\imp p)$ and $u$, we have $u\imp p$. Since $u\imp p$ and $u$, we have $p$, completing the proof.

Claim: $(p\imp q)\imp (u\imp p)\imp (u\imp q)$. Proof: Assume $p\imp q$; we need to show $(u\imp p)\imp (u\imp q)$. Assume $u\imp p$; we need to show $u\imp q$. Assume $u$; we need to show $q$. Since $u$ and $u\imp p$ we have $p$. Since $p$ and $p\imp q$ we have $q$.

Here's a faster version of the third claim. Assume $p\imp q$ and $u\imp q$ and $u$. Then $q$. We will follow this style going forward.

Proving that $j=C_u$ is a modality will give us practice with $\vee$, which could be useful since proving $p\vee q$ is not the same as proving $\neg(\neg p\wedge\neg q)$. To prove $p\vee q$, one must prove $p$ or prove $q$. To prove $p\vee q \imp r$, one must prove $p\imp r$ and $q\imp r$.

Claim: $p\imp (u\vee p)$; proof: assume $p$ then $u\vee p$. Claim: $(u\vee (u\vee p))\imp (u\vee p)$; proof: if $u$ then $u\vee p$; if $p$ then $u\vee p$. Claim: $(p\imp q)\imp (u\vee p)\imp (u\vee q)$; proof: assume $p\imp q$ and $u\vee p$; if $u$ then $u\vee q$ and if $p$ then $q$, so $u\vee q$.

Proving that $j=Q_c$ is a modality is basically more of the same. We prove only axiom 2 and leave the rest to the reader.

Claim: $((((p\imp u)\imp u)\imp u)\imp u)\imp (p\imp u)\imp u$. Proof: Suppose $(((p\imp u)\imp u)\imp u)\imp u$ and $p\imp u$. It suffices to show $((p\imp u)\imp u)\imp u$, so assume $(p\imp u)\imp u$. But then since $p\imp u$ holds, $u$ holds, completing the proof.
\end{example}

This gave us a taste of how logical arguments can go. The fact is that anything we can prove with such a logical argument is also sound when we consider the claims semantically. For example, if $U$ is an open set then for any open $P$ we have $P\ss (U\cup P)$ and $U\cup(U\cup P)=U\cup P$. These are trivial to see; it is much more interesting to consider that the other seven claims from \cref{ex.modality_deduction} in light of the open-set semantics of $\imp$ from \eqref{eqn.implication}. The logic is handling quite a lot of point-set topology for us.



\begin{definition}[$j$-closed propositions]\label{def.j_closed_props}
A proposition $P:\prop$ is called \emph{$j$-closed} if $P=jP$. The type of $j$-closed propositions is denoted $\prop_j$.
\end{definition}

% ==== Section ====%
\section{Decidable modalities}

\begin{definition}\label{def.decidable_modality}
We say that a modality $j$ is \emph{decidable} if 
\[jP\vee (P\imp j\false)\]
holds for all $P:\prop$. Define the type $\decmod$ of decidable modalities by
\[
\decmod\coloneqq\{j\colon\prop\to\prop\mid j\tn{ is a modality and } \forall(P:\prop).jP\vee P\imp j\bot\}.
\]
\end{definition}

\begin{proposition}[Decidable modalities commute with $\vee$]
Suppose $j$ is decidable. Then for all $P,Q:\prop$ we have
\[j (P \lor Q) = j P \lor j Q.\]
\end{proposition}
\begin{proof}
The direction $(j P \lor j Q)\imp j (P \lor Q)$ is straightforward. For the converse, assume $j (P \lor Q)$. By decidability we may assume $P\imp j \bot$ and $Q\imp j \bot$. But then we have $j \bot$, which in turn proves $j P$.
\end{proof}

\begin{proposition}[$j \bot$ is prime for decidable $j$]
Suppose $j$ is decidable. Then for all $P,Q:\prop$, we have
\[\big((P\wedge Q)\imp j \false\big)\imp\big((P\imp j \false)\vee(Q\imp j \false)\big)\]
\end{proposition}
\begin{proof}
Assume $(P\wedge Q)\imp j \false$. By \cref{ax.decidability} we may assume also that $j P$ and $j Q$, hence $j (P\wedge Q)$ and finally $j \bot$.
\end{proof}

\begin{proposition}[$\At$ is quasi-closed]
Suppose $j$ is decidable. Then for all $P:\prop$ we have
\[j P=\big((P\imp j\bot)\imp j\bot\big).\]
\end{proposition}
\begin{proof}
The forward direction would hold for any modality, and the backward direction follows directly from decidability.
\end{proof}

We now turn to the treatment of the existential quantifier.

\begin{lemma}%[The $j$-existential quantifier as a double $j$-negation]--It's not really a double negation, right?
	Let $j$ be a decidable modality, $X$ any type, and $P : X \to \prop$ a predicate. Then
	\[
		j \exists (x : X) . P(x) \quad \Longleftrightarrow \quad \left( \forall (x : X). (P(x) \imp j \bot) \right) \imp j \bot.
	\]
\end{lemma}

\begin{proof}
	From left to right, we can assume $j \left( \exists x. P(x)\right)$ and $\forall x. P(x) \imp j\bot$ to prove $j\bot$. Since the goal is $j$-closed, we can strengthen the first assumption to $\exists x. P(x)$. Choosing $x$ with $P(x)$ and applying $P(x) \imp j\bot$ therefore results in $j\bot$.

	From right to left, suppose by $j$-decidability that $\left( \exists x. P(x) \right) \imp j\bot$. Therefore $\forall x. (P(x) \imp j\bot)$. Plugging this into the assumption on the right shows $j\bot$, which is enough.
\end{proof}



% ======== Chapter ========%
\chapter{Main theorem}

% ======== Chapter ========%
\chapter{Open questions}

\begin{enumerate}
	\item Stochastic processes
  \begin{enumerate}
  	\item Origin
		\item Examples and importance
		\item Sheaf-theoretic definition from email (points)
		\item Kolmogorov extension theorem (The functor of Radon measures on a suitable category of spaces (completely regular Hausdorff) commutes with cofiltered limits.
%https://www.sciencedirect.com/science/article/pii/S1571066115000778		
		)
	\end{enumerate}	
	\item Temporal type theory
  \begin{enumerate}
  	\item Another approach to behaviors in time
		\item Toposes, logic
		\item Motivation: formulate stochastic processes internally
		\item Internal valuations = stochastic processes?
	\end{enumerate}	
	\item Generalization: Vietoris hyperspaces
  \begin{enumerate}
  	\item Some regularity condition (locally compact, Hausdorff)
		\item Use hyperspace for that
		\item Or even more generally: "a topos with enough points"
		\item Topos of sheaves on any space?
	\end{enumerate}	
		
	\item Plan
  \begin{enumerate}
  	\item Background
	  \begin{enumerate}
	  	\item Toposes
			\item Internal language
			\item Modalities, quasi-closed
			\item Internal spaces -- Moerdijk's theorem
			\item Valuations
		\end{enumerate}
		\item Axioms and soundness
		\item Development of theory
		\item Main theorem
		\item Open questions
	\end{enumerate}	
\end{enumerate}

\section*{Acknowledgements}
David Spivak acknowledges the support from Honeywell and from AFOSR grants FA9550-17-1-0058 and FA9550-19-1-0113.

We also benefited very much from conversations with Nelson Niu; in particular he developed an early form of \cref{vals_vs_modalities}.

\printbibliography

\end{document}
